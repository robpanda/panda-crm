generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                  String              @id @default(cuid())
  salesforceId        String?             @unique @map("salesforce_id")
  name                String
  accountNumber       String?             @unique @map("account_number")
  billingStreet       String?             @map("billing_street")
  billingCity         String?             @map("billing_city")
  billingState        String?             @map("billing_state")
  billingPostalCode   String?             @map("billing_postal_code")
  billingCountry      String?             @map("billing_country")
  phone               String?
  email               String?
  website             String?
  type                AccountType         @default(RESIDENTIAL)
  status              AccountStatus       @default(NEW)
  industry            String?
  totalSalesVolume    Decimal?            @map("total_sales_volume") @db.Decimal(12, 2)
  totalContractValue  Decimal?            @map("total_contract_value") @db.Decimal(12, 2)
  totalInvoiceAmount  Decimal?            @map("total_invoice_amount") @db.Decimal(12, 2)
  totalPaidAmount     Decimal?            @map("total_paid_amount") @db.Decimal(12, 2)
  balanceDue          Decimal?            @map("balance_due") @db.Decimal(12, 2)
  invoiceCount        Int?                @default(0) @map("invoice_count")
  overdueInvoiceCount Int?                @default(0) @map("overdue_invoice_count")
  totalOverdueAmount  Decimal?            @map("total_overdue_amount") @db.Decimal(12, 2)
  collectedPercent    Decimal?            @map("collected_percent") @db.Decimal(5, 2)
  lastPaymentDate     DateTime?           @map("last_payment_date")
  stripeCustomerId    String?             @unique @map("stripe_customer_id")
  qbCustomerId        String?             @unique @map("qb_customer_id")
  qbSyncStatus        SyncStatus?         @map("qb_sync_status")
  qbLastSyncAt        DateTime?           @map("qb_last_sync_at")
  isPandaClaims       Boolean             @default(false) @map("is_panda_claims")
  isSureClaims        Boolean             @default(false) @map("is_sure_claims")
  ownerId             String?             @map("owner_id")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  description         String?
  shippingCity        String?             @map("shipping_city")
  shippingCountry     String?             @map("shipping_country")
  shippingPostalCode  String?             @map("shipping_postal_code")
  shippingState       String?             @map("shipping_state")
  shippingStreet      String?             @map("shipping_street")
  geocodeStatus       String?             @map("geocode_status")
  geocodedAt          DateTime?           @map("geocoded_at")
  latitude            Float?              @map("latitude")
  longitude           Float?              @map("longitude")
  deleted_at          DateTime?
  owner               User?               @relation("AccountOwner", fields: [ownerId], references: [id])
  activities          Activity[]          @relation("AccountActivities")
  agreements          Agreement[]
  attentionItems      AttentionItem[]     @relation("AccountAttentionItems")
  callLogs            CallLog[]
  cases               Case[]
  companycam_projects CompanyCamProject[]
  contacts            Contact[]
  emailMessages       EmailMessage[]      @relation("AccountEmails")
  emails              Email[]             @relation("AccountEmails")
  events              Event[]             @relation("AccountEvents")
  invoices            Invoice[]
  measurementReports  MeasurementReport[]
  mobileActivities    MobileActivity[]
  notes               Note[]              @relation("AccountNotes")
  notifications       Notification[]      @relation("AccountNotifications")
  opportunities       Opportunity[]
  workOrders          WorkOrder[]

  @@index([status])
  @@index([ownerId])
  @@index([billingState])
  @@index([deleted_at])
  @@map("accounts")
}

model Contact {
  id                     String          @id @default(cuid())
  salesforceId           String?         @unique @map("salesforce_id")
  firstName              String          @map("first_name")
  lastName               String          @map("last_name")
  fullName               String?         @map("full_name")
  email                  String?
  phone                  String?
  mobilePhone            String?         @map("mobile_phone")
  smsNumber              String?         @map("sms_number")
  mailingStreet          String?         @map("mailing_street")
  mailingCity            String?         @map("mailing_city")
  mailingState           String?         @map("mailing_state")
  mailingPostalCode      String?         @map("mailing_postal_code")
  title                  String?
  department             String?
  smsOptOut              Boolean         @default(false) @map("sms_opt_out")
  emailOptOut            Boolean         @default(false) @map("email_opt_out")
  doNotCall              Boolean         @default(false) @map("do_not_call")
  preferredContactMethod String?         @map("preferred_contact_method")
  accountId              String?         @map("account_id")
  isPrimary              Boolean         @default(false) @map("is_primary")
  createdAt              DateTime        @default(now()) @map("created_at")
  updatedAt              DateTime        @updatedAt @map("updated_at")
  deleted_at             DateTime?
  activities             Activity[]      @relation("ContactActivities")
  agreements             Agreement[]
  attentionItems         AttentionItem[] @relation("ContactAttentionItems")
  callLogs               CallLog[]
  account                Account?        @relation(fields: [accountId], references: [id])
  emailMessages          EmailMessage[]  @relation("ContactEmails")
  emails                 Email[]         @relation("ContactEmails")
  events                 Event[]         @relation("ContactEvents")
  messages               Message[]
  notes                  Note[]          @relation("ContactNotes")
  notifications          Notification[]  @relation("ContactNotifications")
  opportunities          Opportunity[]   @relation("OpportunityContact")

  @@index([accountId])
  @@index([email])
  @@index([smsNumber])
  @@index([deleted_at])
  @@map("contacts")
}

model Lead {
  id                       String              @id @default(cuid())
  salesforceId             String?             @unique @map("salesforce_id")
  firstName                String              @map("first_name")
  lastName                 String              @map("last_name")
  company                  String?
  email                    String?
  phone                    String?
  mobilePhone              String?             @map("mobile_phone")
  street                   String?
  city                     String?
  state                    String?
  postalCode               String?             @map("postal_code")
  status                   LeadStatus          @default(NEW)
  source                   String?             @map("lead_source")
  rating                   LeadRating?
  industry                 String?
  score                    Int                 @default(0)
  campaignId               String?             @map("campaign_id")
  ownerId                  String?             @map("owner_id")
  isSelfGen                Boolean             @default(false) @map("is_self_gen")
  selfGenRepId             String?             @map("self_gen_rep_id")
  isConverted              Boolean             @default(false) @map("is_converted")
  convertedDate            DateTime?           @map("converted_date")
  convertedAccountId       String?             @map("converted_account_id")
  convertedContactId       String?             @map("converted_contact_id")
  convertedOpportunityId   String?             @map("converted_opportunity_id")
  propertyType             String?             @map("property_type")
  workType                 String?             @map("work_type")
  leadNotes                String?             @map("lead_notes")
  description              String?
  salesRabbitUser          String?             @map("sales_rabbit_user")
  title                    String?
  disposition              String?
  assignedAt               DateTime?           @map("assigned_at")
  assignedById             String?             @map("assigned_by_id")
  assignmentRuleId         String?             @map("assignment_rule_id")
  createdAt                DateTime            @default(now()) @map("created_at")
  updatedAt                DateTime            @updatedAt @map("updated_at")
  country                  String?
  tentativeAppointmentDate DateTime?           @map("tentative_appointment_date")
  tentativeAppointmentTime String?             @map("tentative_appointment_time")
  leadSetById              String?             @map("lead_set_by_id")
  leadRank                 String?             @map("lead_rank")
  scoreFactors             Json?               @map("score_factors")
  scoredAt                 DateTime?           @map("scored_at")
  scoreVersion             Int?                @map("score_version")
  medianHouseholdIncome    Int?                @map("median_household_income")
  medianHomeValue          Int?                @map("median_home_value")
  homeownershipRate        Int?                @map("homeownership_rate")
  medianAge                Float?              @map("median_age")
  enrichedAt               DateTime?           @map("enriched_at")
  leadScore                Int?                @map("lead_score")
  deleted_at               DateTime?
  call_attempts            Int                 @default(0)
  callback_scheduled_at    DateTime?
  cooldown_until           DateTime?
  current_list_id          String?
  last_call_at             DateTime?
  last_call_result         String?
  next_call_at             DateTime?
  activities               Activity[]          @relation("LeadActivities")
  attentionItems           AttentionItem[]     @relation("LeadAttentionItems")
  callLogs                 CallLog[]
  emailMessages            EmailMessage[]      @relation("LeadEmails")
  emails                   Email[]             @relation("LeadEmails")
  events                   Event[]             @relation("LeadEvents")
  assignmentLogs           LeadAssignmentLog[]
  leadSetBy                User?               @relation("LeadSetByUser", fields: [leadSetById], references: [id])
  owner                    User?               @relation("LeadOwner", fields: [ownerId], references: [id])
  notes                    Note[]              @relation("LeadNotes")
  notifications            Notification[]      @relation("LeadNotifications")
  tasks                    Task[]              @relation("LeadTasks")

  // Champion Referral fields
  isChampionReferral       Boolean             @default(false) @map("is_champion_referral")
  championReferralId       String?             @unique @map("champion_referral_id")
  referredByChampionId     String?             @map("referred_by_champion_id")

  @@index([status])
  @@index([ownerId])
  @@index([source])
  @@index([isConverted])
  @@index([workType])
  @@index([callback_scheduled_at])
  @@index([current_list_id])
  @@index([deleted_at])
  @@index([disposition])
  @@index([next_call_at])
  @@map("leads")
}

model Opportunity {
  id                       String                  @id @default(cuid())
  salesforceId             String?                 @unique @map("salesforce_id")
  name                     String
  description              String?
  stage                    OpportunityStage        @default(LEAD_UNASSIGNED)
  status                   String?
  probability              Int                     @default(0)
  closeDate                DateTime?               @map("close_date")
  appointmentDate          DateTime?               @map("appointment_date")
  soldDate                 DateTime?               @map("sold_date")
  amount                   Decimal?                @db.Decimal(12, 2)
  contractTotal            Decimal?                @map("contract_total") @db.Decimal(12, 2)
  type                     OpportunityType         @default(INSURANCE)
  workType                 String?                 @map("work_type")
  leadSource               String?                 @map("lead_source")
  isSelfGen                Boolean                 @default(false) @map("is_self_gen")
  street                   String?
  city                     String?
  state                    String?
  postalCode               String?                 @map("postal_code")
  isPandaClaims            Boolean                 @default(false) @map("is_panda_claims")
  isApproved               Boolean                 @default(false) @map("is_approved")
  claimNumber              String?                 @map("claim_number")
  claimFiledDate           DateTime?               @map("claim_filed_date")
  insuranceCarrier         String?                 @map("insurance_carrier")
  rcvAmount                Decimal?                @map("rcv_amount") @db.Decimal(12, 2)
  acvAmount                Decimal?                @map("acv_amount") @db.Decimal(12, 2)
  deductible               Decimal?                @db.Decimal(12, 2)
  supplementsTotal         Decimal?                @map("supplements_total") @db.Decimal(12, 2)
  accountId                String                  @map("account_id")
  contactId                String?                 @map("contact_id")
  ownerId                  String?                 @map("owner_id")
  createdAt                DateTime                @default(now()) @map("created_at")
  updatedAt                DateTime                @updatedAt @map("updated_at")
  serviceRequired          Boolean                 @default(false) @map("service_required")
  serviceComplete          Boolean                 @default(false) @map("service_complete")
  serviceRequestDate       DateTime?               @map("service_request_date")
  serviceNotes             String?                 @map("service_notes")
  projectManagerId         String?                 @map("project_manager_id")
  job_id                   String?                 @unique
  damage_location          String?
  date_of_loss             DateTime?
  priority                 Priority                @default(NORMAL)
  priority_auto_escalate   Boolean                 @default(true)
  priority_reason          String?
  priority_set_at          DateTime?
  specs_prepped            Boolean                 @default(false)
  specs_prep_date          DateTime?
  specs_data               String?
  deleted_at               DateTime?
  change_order_pending     Boolean                 @default(false)
  change_order_amount      Decimal?                @db.Decimal(12, 2)
  change_order_date        DateTime?
  change_order_signed      Boolean                 @default(false)
  change_order_signed_date DateTime?
  follow_up_date           DateTime?
  invoice_ready_date       DateTime?
  invoice_status           InvoiceWorkflowStatus   @default(NOT_READY)
  invoiced_date            DateTime?
  activities               Activity[]              @relation("OpportunityActivities")
  agreements               Agreement[]
  approvalRequests         ApprovalRequest[]
  attentionItems           AttentionItem[]         @relation("OpportunityAttentionItems")
  callLogs                 CallLog[]
  commissions              Commission[]
  companycam_projects      CompanyCamProject?
  emailMessages            EmailMessage[]          @relation("OpportunityEmails")
  emails                   Email[]                 @relation("OpportunityEmails")
  events                   Event[]                 @relation("OpportunityEvents")
  materialOrders           MaterialOrder[]
  measurementReports       MeasurementReport[]
  mobileActivities         MobileActivity[]
  notes                    Note[]                  @relation("OpportunityNotes")
  notifications            Notification[]          @relation("OpportunityNotifications")
  account                  Account                 @relation(fields: [accountId], references: [id])
  contact                  Contact?                @relation("OpportunityContact", fields: [contactId], references: [id])
  owner                    User?                   @relation("OpportunityOwner", fields: [ownerId], references: [id])
  projectManager           User?                   @relation("OpportunityProjectManager", fields: [projectManagerId], references: [id])
  lineItems                OpportunityLineItem[]
  orders                   Order[]
  quotes                   Quote[]
  serviceContract          ServiceContract?
  tasks                    Task[]                  @relation("OpportunityTasks")
  work_order_line_items    work_order_line_items[]
  workOrders               WorkOrder[]

  @@index([accountId])
  @@index([ownerId])
  @@index([stage])
  @@index([closeDate])
  @@index([projectManagerId])
  @@index([deleted_at])
  @@map("opportunities")
}

model OpportunityLineItem {
  id            String      @id @default(cuid())
  name          String
  description   String?
  productCode   String?     @map("product_code")
  quantity      Int         @default(1)
  unitPrice     Decimal     @map("unit_price") @db.Decimal(12, 2)
  totalPrice    Decimal     @map("total_price") @db.Decimal(12, 2)
  discount      Decimal?    @db.Decimal(12, 2)
  sortOrder     Int         @default(0) @map("sort_order")
  opportunityId String      @map("opportunity_id")
  productId     String?     @map("product_id")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)
  product       Product?    @relation(fields: [productId], references: [id])

  @@index([opportunityId])
  @@map("opportunity_line_items")
}

model WorkOrder {
  id                    String                  @id @default(cuid())
  salesforceId          String?                 @unique @map("salesforce_id")
  workOrderNumber       String                  @unique @map("work_order_number")
  subject               String?
  description           String?
  status                WorkOrderStatus         @default(NEW)
  priority              Priority                @default(NORMAL)
  accountId             String                  @map("account_id")
  opportunityId         String?                 @map("opportunity_id")
  workTypeId            String?                 @map("work_type_id")
  territoryId           String?                 @map("territory_id")
  startDate             DateTime?               @map("start_date")
  endDate               DateTime?               @map("end_date")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  attentionItems        AttentionItem[]         @relation("WorkOrderAttentionItems")
  materialOrders        MaterialOrder[]
  notifications         Notification[]          @relation("WorkOrderNotifications")
  serviceAppointments   ServiceAppointment[]
  work_order_line_items work_order_line_items[]
  account               Account                 @relation(fields: [accountId], references: [id])
  opportunity           Opportunity?            @relation(fields: [opportunityId], references: [id])
  territory             ServiceTerritory?       @relation(fields: [territoryId], references: [id])
  workType              WorkType?               @relation(fields: [workTypeId], references: [id])

  @@index([accountId])
  @@index([opportunityId])
  @@index([status])
  @@map("work_orders")
}

model ServiceAppointment {
  id                    String             @id @default(cuid())
  salesforceId          String?            @unique @map("salesforce_id")
  appointmentNumber     String             @unique @map("appointment_number")
  subject               String?
  description           String?
  status                AppointmentStatus  @default(NONE)
  street                String?
  city                  String?
  state                 String?
  postalCode            String?            @map("postal_code")
  earliestStart         DateTime?          @map("earliest_start")
  dueDate               DateTime?          @map("due_date")
  scheduledStart        DateTime?          @map("scheduled_start")
  scheduledEnd          DateTime?          @map("scheduled_end")
  actualStart           DateTime?          @map("actual_start")
  actualEnd             DateTime?          @map("actual_end")
  duration              Int?
  googleCalendarEventId String?            @map("google_calendar_event_id")
  workOrderId           String             @map("work_order_id")
  createdAt             DateTime           @default(now()) @map("created_at")
  updatedAt             DateTime           @updatedAt @map("updated_at")
  geocodedAt            DateTime?          @map("geocoded_at")
  latitude              Float?             @map("latitude")
  longitude             Float?             @map("longitude")
  travelDistanceMiles   Float?             @map("travel_distance_miles")
  travelTimeMinutes     Int?               @map("travel_time_minutes")
  work_type_id          String?
  assignedResources     AssignedResource[]
  workOrder             WorkOrder          @relation(fields: [workOrderId], references: [id])
  work_types            WorkType?          @relation(fields: [work_type_id], references: [id])

  @@index([workOrderId])
  @@index([status])
  @@index([scheduledStart])
  @@index([work_type_id])
  @@map("service_appointments")
}

model ServiceResource {
  id                        String                   @id @default(cuid())
  salesforceId              String?                  @unique @map("salesforce_id")
  name                      String
  resourceType              ResourceType             @default(TECHNICIAN)
  isActive                  Boolean                  @default(true) @map("is_active")
  email                     String?
  phone                     String?
  googleCalendarId          String?                  @map("google_calendar_id")
  googleCalendarSyncEnabled Boolean                  @default(false) @map("google_calendar_sync_enabled")
  googleCalendarConnected   Boolean                  @default(false) @map("google_calendar_connected")
  googleAccessToken         String?                  @map("google_access_token")
  googleRefreshToken        String?                  @map("google_refresh_token")
  googleTokenExpiry         DateTime?                @map("google_token_expiry")
  userId                    String?                  @unique @map("user_id")
  createdAt                 DateTime                 @default(now()) @map("created_at")
  updatedAt                 DateTime                 @updatedAt @map("updated_at")
  assignments               AssignedResource[]
  absences                  ResourceAbsence[]
  capacities                ResourceCapacity[]
  capacityPlans             ResourceCapacityPlan[]
  skills                    ResourceSkill[]
  user                      User?                    @relation(fields: [userId], references: [id])
  territoryMembers          ServiceTerritoryMember[]

  @@index([resourceType])
  @@index([isActive])
  @@map("service_resources")
}

model AssignedResource {
  id                   String             @id @default(cuid())
  serviceAppointmentId String             @map("service_appointment_id")
  serviceResourceId    String             @map("service_resource_id")
  isPrimaryResource    Boolean            @default(false) @map("is_primary_resource")
  createdAt            DateTime           @default(now()) @map("created_at")
  serviceAppointment   ServiceAppointment @relation(fields: [serviceAppointmentId], references: [id])
  serviceResource      ServiceResource    @relation(fields: [serviceResourceId], references: [id])

  @@unique([serviceAppointmentId, serviceResourceId])
  @@map("assigned_resources")
}

model ServiceTerritory {
  id                    String                   @id @default(cuid())
  salesforceId          String?                  @unique @map("salesforce_id")
  name                  String
  description           String?
  isActive              Boolean                  @default(true) @map("is_active")
  state                 String?
  city                  String?
  postalCodes           String[]                 @map("postal_codes")
  operatingHoursId      String?                  @map("operating_hours_id")
  createdAt             DateTime                 @default(now()) @map("created_at")
  updatedAt             DateTime                 @updatedAt @map("updated_at")
  scheduleOptimizations ScheduleOptimization[]
  operatingHours        OperatingHours?          @relation(fields: [operatingHoursId], references: [id])
  members               ServiceTerritoryMember[]
  work_order_line_items work_order_line_items[]
  workOrders            WorkOrder[]

  @@map("service_territories")
}

model ServiceTerritoryMember {
  id                 String           @id @default(cuid())
  territoryId        String           @map("territory_id")
  resourceId         String           @map("resource_id")
  isPrimary          Boolean          @default(false) @map("is_primary")
  effectiveStartDate DateTime?        @map("effective_start_date")
  effectiveEndDate   DateTime?        @map("effective_end_date")
  resource           ServiceResource  @relation(fields: [resourceId], references: [id])
  territory          ServiceTerritory @relation(fields: [territoryId], references: [id])

  @@unique([territoryId, resourceId])
  @@map("service_territory_members")
}

model WorkType {
  id                    String                  @id @default(cuid())
  salesforceId          String?                 @unique @map("salesforce_id")
  name                  String
  description           String?
  estimatedDuration     Int?                    @map("estimated_duration")
  service_appointments  ServiceAppointment[]
  work_order_line_items work_order_line_items[]
  workOrders            WorkOrder[]

  @@map("work_types")
}

model OperatingHours {
  id          String             @id @default(cuid())
  name        String
  timeZone    String             @default("America/New_York") @map("time_zone")
  territories ServiceTerritory[]
  timeSlots   TimeSlot[]

  @@map("operating_hours")
}

model TimeSlot {
  id               String         @id @default(cuid())
  operatingHoursId String         @map("operating_hours_id")
  dayOfWeek        Int            @map("day_of_week")
  startTime        String         @map("start_time")
  endTime          String         @map("end_time")
  operatingHours   OperatingHours @relation(fields: [operatingHoursId], references: [id])

  @@map("time_slots")
}

model ResourceAbsence {
  id          String          @id @default(cuid())
  resourceId  String          @map("resource_id")
  type        AbsenceType     @default(VACATION)
  start       DateTime
  end         DateTime
  description String?
  resource    ServiceResource @relation(fields: [resourceId], references: [id])

  @@map("resource_absences")
}

model Skill {
  id          String          @id @default(cuid())
  name        String          @unique
  description String?
  resources   ResourceSkill[]

  @@map("skills")
}

model ResourceSkill {
  id         String          @id @default(cuid())
  resourceId String          @map("resource_id")
  skillId    String          @map("skill_id")
  level      SkillLevel      @default(INTERMEDIATE)
  resource   ServiceResource @relation(fields: [resourceId], references: [id])
  skill      Skill           @relation(fields: [skillId], references: [id])

  @@unique([resourceId, skillId])
  @@map("resource_skills")
}

model DistanceCache {
  id              String   @id @default(cuid())
  originLat       Float    @map("origin_lat")
  originLon       Float    @map("origin_lon")
  destLat         Float    @map("dest_lat")
  destLon         Float    @map("dest_lon")
  distanceMeters  Int      @map("distance_meters")
  durationSeconds Int      @map("duration_seconds")
  provider        String   @default("google")
  createdAt       DateTime @default(now()) @map("created_at")
  expiresAt       DateTime @map("expires_at")

  @@unique([originLat, originLon, destLat, destLon, provider])
  @@index([originLat, originLon])
  @@index([destLat, destLon])
  @@map("distance_cache")
}

model SchedulingPolicy {
  id                        String   @id @default(cuid())
  name                      String   @unique
  description               String?
  isDefault                 Boolean  @default(false) @map("is_default")
  isActive                  Boolean  @default(true) @map("is_active")
  weightCustomerPreference  Int      @default(80) @map("weight_customer_preference")
  weightSkillMatch          Int      @default(90) @map("weight_skill_match")
  weightTravelDistance      Int      @default(70) @map("weight_travel_distance")
  weightResourceUtilization Int      @default(60) @map("weight_resource_utilization")
  weightSameDayCompletion   Int      @default(50) @map("weight_same_day_completion")
  weightPriority            Int      @default(85) @map("weight_priority")
  requireExactSkillMatch    Boolean  @default(false) @map("require_exact_skill_match")
  requireSameTerritory      Boolean  @default(true) @map("require_same_territory")
  allowOvertimeScheduling   Boolean  @default(false) @map("allow_overtime_scheduling")
  maxTravelTimeMinutes      Int      @default(60) @map("max_travel_time_minutes")
  maxAppointmentsPerDay     Int      @default(8) @map("max_appointments_per_day")
  minBufferMinutes          Int      @default(15) @map("min_buffer_minutes")
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")

  @@map("scheduling_policies")
}

model ResourceCapacityPlan {
  id                String          @id @default(cuid())
  resourceId        String          @map("resource_id")
  date              DateTime        @db.Date
  plannedCapacity   Int             @default(480) @map("planned_capacity")
  scheduledMinutes  Int             @default(0) @map("scheduled_minutes")
  travelMinutes     Int             @default(0) @map("travel_minutes")
  availableMinutes  Int             @default(480) @map("available_minutes")
  targetUtilization Float           @default(0.75) @map("target_utilization")
  actualUtilization Float           @default(0) @map("actual_utilization")
  appointmentCount  Int             @default(0) @map("appointment_count")
  completedCount    Int             @default(0) @map("completed_count")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  resource          ServiceResource @relation(fields: [resourceId], references: [id])

  @@unique([resourceId, date])
  @@index([date])
  @@map("resource_capacity_plans")
}

model Quote {
  id                  String            @id @default(cuid())
  salesforceId        String?           @unique @map("salesforce_id")
  quoteNumber         String            @unique @map("quote_number")
  name                String
  status              QuoteStatus       @default(DRAFT)
  expirationDate      DateTime?         @map("expiration_date")
  subtotal            Decimal           @default(0) @db.Decimal(12, 2)
  discount            Decimal           @default(0) @db.Decimal(12, 2)
  tax                 Decimal           @default(0) @db.Decimal(12, 2)
  total               Decimal           @default(0) @db.Decimal(12, 2)
  isPmQuote           Boolean           @default(false) @map("is_pm_quote")
  opportunityId       String            @map("opportunity_id")
  pricebookId         String?           @map("pricebook_id")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  affected_structures String?
  estimate_type       String?
  is_estimate_request Boolean           @default(false)
  owner_id            String?
  priority_level      String?
  trade_type          String?
  due_date            DateTime?
  is_recurring        Boolean           @default(false)
  other_information   String?
  recurring_end_date  DateTime?
  recurring_frequency String?
  reminder_date_time  DateTime?
  reminder_enabled    Boolean           @default(false)
  task_status         String?
  approvalRequests    ApprovalRequest[]
  attentionItems      AttentionItem[]   @relation("QuoteAttentionItems")
  lineItems           QuoteLineItem[]
  opportunity         Opportunity       @relation(fields: [opportunityId], references: [id])
  users               User?             @relation(fields: [owner_id], references: [id])
  pricebook           Pricebook?        @relation("QuotePricebook", fields: [pricebookId], references: [id])

  @@index([opportunityId])
  @@index([status])
  @@index([is_estimate_request])
  @@index([owner_id])
  @@map("quotes")
}

model QuoteLineItem {
  id          String   @id @default(cuid())
  quoteId     String   @map("quote_id")
  productId   String?  @map("product_id")
  description String?
  quantity    Decimal  @default(1) @db.Decimal(10, 2)
  unitPrice   Decimal  @map("unit_price") @db.Decimal(12, 2)
  discount    Decimal  @default(0) @db.Decimal(12, 2)
  totalPrice  Decimal  @map("total_price") @db.Decimal(12, 2)
  sortOrder   Int      @default(0) @map("sort_order")
  product     Product? @relation(fields: [productId], references: [id])
  quote       Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@map("quote_line_items")
}

model Order {
  id                    String            @id @default(cuid())
  salesforceId          String?           @unique @map("salesforce_id")
  orderNumber           String            @unique @map("order_number")
  status                OrderStatus       @default(DRAFT)
  type                  OrderType         @default(STANDARD)
  effectiveDate         DateTime?         @map("effective_date")
  subtotal              Decimal           @default(0) @db.Decimal(12, 2)
  tax                   Decimal           @default(0) @db.Decimal(12, 2)
  total                 Decimal           @default(0) @db.Decimal(12, 2)
  abcConfirmationNumber String?           @map("abc_confirmation_number")
  abcOrderNumber        String?           @map("abc_order_number")
  abcStatus             String?           @map("abc_status")
  opportunityId         String?           @map("opportunity_id")
  accountId             String            @map("account_id")
  createdAt             DateTime          @default(now()) @map("created_at")
  updatedAt             DateTime          @updatedAt @map("updated_at")
  abcLastUpdate         DateTime?         @map("abc_last_update")
  abcProofOfDeliveryUrl String?           @map("abc_proof_of_delivery_url")
  abcShipmentNumber     String?           @map("abc_shipment_number")
  abcShipmentStatus     String?           @map("abc_shipment_status")
  abcTrackingId         String?           @map("abc_tracking_id")
  deliveryDate          DateTime?         @map("delivery_date")
  approvalRequests      ApprovalRequest[]
  materialOrders        MaterialOrder[]
  lineItems             OrderLineItem[]
  opportunity           Opportunity?      @relation(fields: [opportunityId], references: [id])

  @@index([opportunityId])
  @@index([status])
  @@map("orders")
}

model OrderLineItem {
  id            String   @id @default(cuid())
  orderId       String   @map("order_id")
  productId     String?  @map("product_id")
  description   String?
  quantity      Decimal  @default(1) @db.Decimal(10, 2)
  unitPrice     Decimal  @map("unit_price") @db.Decimal(12, 2)
  totalPrice    Decimal  @map("total_price") @db.Decimal(12, 2)
  abcItemNumber String?  @map("abc_item_number")
  productName   String?  @map("product_name")
  uom           String?
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product? @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@map("order_line_items")
}

model MaterialOrder {
  id                    String                  @id @default(cuid())
  materialOrderNumber   String                  @unique @map("material_order_number")
  materialStatus        MaterialStatus          @default(WAITING) @map("material_status")
  supplierId            String?                 @map("supplier_id")
  supplierOrderNumber   String?                 @map("supplier_order_number")
  deliveryType          DeliveryType            @default(DELIVERY) @map("delivery_type")
  deliveryDate          DateTime?               @map("delivery_date")
  deliveryTimeWindow    DeliveryTimeWindow?     @map("delivery_time_window")
  actualDeliveryDate    DateTime?               @map("actual_delivery_date")
  deliveryNotes         String?                 @map("delivery_notes")
  deliveryStreet        String?                 @map("delivery_street")
  deliveryCity          String?                 @map("delivery_city")
  deliveryState         String?                 @map("delivery_state")
  deliveryPostalCode    String?                 @map("delivery_postal_code")
  estimatedCost         Decimal?                @map("estimated_cost") @db.Decimal(12, 2)
  actualCost            Decimal?                @map("actual_cost") @db.Decimal(12, 2)
  abcConfirmationNumber String?                 @map("abc_confirmation_number")
  abcOrderNumber        String?                 @map("abc_order_number")
  abcStatus             String?                 @map("abc_status")
  abcShipmentNumber     String?                 @map("abc_shipment_number")
  abcTrackingId         String?                 @map("abc_tracking_id")
  abcProofOfDeliveryUrl String?                 @map("abc_proof_of_delivery_url")
  abcLastUpdate         DateTime?               @map("abc_last_update")
  workOrderId           String                  @map("work_order_id")
  opportunityId         String?                 @map("opportunity_id")
  accountId             String?                 @map("account_id")
  orderId               String?                 @map("order_id")
  orderedById           String?                 @map("ordered_by_id")
  orderedAt             DateTime?               @map("ordered_at")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  lineItems             MaterialOrderLineItem[]
  opportunity           Opportunity?            @relation(fields: [opportunityId], references: [id])
  order                 Order?                  @relation(fields: [orderId], references: [id])
  orderedBy             User?                   @relation("MaterialOrdersPlaced", fields: [orderedById], references: [id])
  supplier              Supplier?               @relation(fields: [supplierId], references: [id])
  workOrder             WorkOrder               @relation(fields: [workOrderId], references: [id])

  @@index([workOrderId])
  @@index([opportunityId])
  @@index([materialStatus])
  @@index([deliveryDate])
  @@index([supplierId])
  @@map("material_orders")
}

model MaterialOrderLineItem {
  id               String         @id @default(cuid())
  materialOrderId  String         @map("material_order_id")
  productId        String?        @map("product_id")
  description      String
  sku              String?
  quantity         Decimal        @default(1) @db.Decimal(10, 2)
  unit             String?
  unitPrice        Decimal?       @map("unit_price") @db.Decimal(12, 2)
  totalPrice       Decimal?       @map("total_price") @db.Decimal(12, 2)
  itemStatus       MaterialStatus @default(WAITING) @map("item_status")
  receivedQuantity Decimal?       @map("received_quantity") @db.Decimal(10, 2)
  receivedAt       DateTime?      @map("received_at")
  materialOrder    MaterialOrder  @relation(fields: [materialOrderId], references: [id], onDelete: Cascade)
  product          Product?       @relation(fields: [productId], references: [id])

  @@index([materialOrderId])
  @@map("material_order_line_items")
}

model Supplier {
  id                String          @id @default(cuid())
  name              String
  code              String?         @unique
  phone             String?
  email             String?
  website           String?
  street            String?
  city              String?
  state             String?
  postalCode        String?         @map("postal_code")
  accountNumber     String?         @map("account_number")
  shipToAccount     String?         @map("ship_to_account")
  isAbcSupply       Boolean         @default(false) @map("is_abc_supply")
  isSrsDistribution Boolean         @default(false) @map("is_srs_distribution")
  isActive          Boolean         @default(true) @map("is_active")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  materialOrders    MaterialOrder[]

  @@index([isActive])
  @@map("suppliers")
}

model Product {
  id                     String                  @id @default(cuid())
  salesforceId           String?                 @unique @map("salesforce_id")
  name                   String
  productCode            String?                 @unique @map("product_code")
  description            String?
  family                 String?
  category               String?
  unitPrice              Decimal?                @map("unit_price") @db.Decimal(12, 2)
  isActive               Boolean                 @default(true) @map("is_active")
  qbProductId            String?                 @map("qb_product_id")
  abcProductId           String?                 @map("abc_product_id")
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  materialOrderLineItems MaterialOrderLineItem[]
  opportunityLineItems   OpportunityLineItem[]
  orderLineItems         OrderLineItem[]
  pricebookEntries       PricebookEntry[]
  quoteLineItems         QuoteLineItem[]

  @@index([family])
  @@index([isActive])
  @@map("products")
}

model Pricebook {
  id           String           @id @default(cuid())
  salesforceId String?          @unique @map("salesforce_id")
  name         String
  description  String?
  isActive     Boolean          @default(true) @map("is_active")
  isStandard   Boolean          @default(false) @map("is_standard")
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  entries      PricebookEntry[]
  quotes       Quote[]          @relation("QuotePricebook")

  @@index([isActive])
  @@map("pricebooks")
}

model PricebookEntry {
  id               String    @id @default(cuid())
  salesforceId     String?   @unique @map("salesforce_id")
  pricebookId      String    @map("pricebook_id")
  productId        String    @map("product_id")
  unitPrice        Decimal   @map("unit_price") @db.Decimal(12, 2)
  useStandardPrice Boolean   @default(false) @map("use_standard_price")
  isActive         Boolean   @default(true) @map("is_active")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  pricebook        Pricebook @relation(fields: [pricebookId], references: [id], onDelete: Cascade)
  product          Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([pricebookId, productId])
  @@index([pricebookId])
  @@index([productId])
  @@map("pricebook_entries")
}

model Invoice {
  id                     String            @id @default(cuid())
  salesforceId           String?           @unique @map("salesforce_id")
  invoiceNumber          String            @unique @map("invoice_number")
  status                 InvoiceStatus     @default(DRAFT)
  invoiceDate            DateTime?         @map("invoice_date")
  dueDate                DateTime?         @map("due_date")
  terms                  Int               @default(30)
  subtotal               Decimal           @default(0) @db.Decimal(12, 2)
  tax                    Decimal           @default(0) @db.Decimal(12, 2)
  total                  Decimal           @default(0) @db.Decimal(12, 2)
  amountPaid             Decimal           @default(0) @map("amount_paid") @db.Decimal(12, 2)
  balanceDue             Decimal           @default(0) @map("balance_due") @db.Decimal(12, 2)
  stripeInvoiceId        String?           @unique @map("stripe_invoice_id")
  stripePaymentLinkId    String?           @map("stripe_payment_link_id")
  stripePaymentLinkUrl   String?           @map("stripe_payment_link_url")
  stripeHostedInvoiceUrl String?           @map("stripe_hosted_invoice_url")
  qbInvoiceId            String?           @map("qb_invoice_id")
  qbDocNumber            String?           @map("qb_doc_number")
  qbSyncStatus           SyncStatus?       @map("qb_sync_status")
  qbLastSyncAt           DateTime?         @map("qb_last_sync_at")
  qbSyncError            String?           @map("qb_sync_error")
  accountId              String            @map("account_id")
  serviceContractId      String?           @map("service_contract_id")
  opportunityId          String?           @map("opportunity_id")
  isPmInvoice            Boolean           @default(false) @map("is_pm_invoice")
  createdAt              DateTime          @default(now()) @map("created_at")
  updatedAt              DateTime          @updatedAt @map("updated_at")
  pdf_key                String?
  pdf_url                String?
  claim_number           String?
  insurance_carrier      String?
  is_insurance_invoice   Boolean           @default(false)
  notes                  String?
  attentionItems         AttentionItem[]   @relation("InvoiceAttentionItems")
  lineItems              InvoiceLineItem[]
  account                Account           @relation(fields: [accountId], references: [id])
  serviceContract        ServiceContract?  @relation(fields: [serviceContractId], references: [id])
  payments               Payment[]

  @@index([accountId])
  @@index([serviceContractId])
  @@index([opportunityId])
  @@index([status])
  @@index([dueDate])
  @@index([stripeInvoiceId])
  @@map("invoices")
}

model InvoiceLineItem {
  id          String  @id @default(cuid())
  invoiceId   String  @map("invoice_id")
  description String
  quantity    Decimal @default(1) @db.Decimal(10, 2)
  unitPrice   Decimal @map("unit_price") @db.Decimal(12, 2)
  totalPrice  Decimal @map("total_price") @db.Decimal(12, 2)
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("invoice_line_items")
}

model Payment {
  id                    String        @id @default(cuid())
  salesforceId          String?       @unique @map("salesforce_id")
  paymentNumber         String        @unique @map("payment_number")
  amount                Decimal       @db.Decimal(12, 2)
  paymentDate           DateTime      @map("payment_date")
  paymentMethod         PaymentMethod @default(CHECK) @map("payment_method")
  status                PaymentStatus @default(PENDING)
  referenceNumber       String?       @map("reference_number")
  notes                 String?
  stripePaymentIntentId String?       @unique @map("stripe_payment_intent_id")
  stripeChargeId        String?       @map("stripe_charge_id")
  stripeReceiptUrl      String?       @map("stripe_receipt_url")
  stripePaymentMethodId String?       @map("stripe_payment_method_id")
  stripeRefundId        String?       @map("stripe_refund_id")
  stripeFailureCode     String?       @map("stripe_failure_code")
  stripeFailureMessage  String?       @map("stripe_failure_message")
  qbPaymentId           String?       @map("qb_payment_id")
  qbSyncStatus          SyncStatus?   @map("qb_sync_status")
  qbLastSyncAt          DateTime?     @map("qb_last_sync_at")
  qbSyncError           String?       @map("qb_sync_error")
  invoiceId             String        @map("invoice_id")
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  invoice               Invoice       @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([stripePaymentIntentId])
  @@index([status])
  @@map("payments")
}

model PaymentLink {
  id                  String            @id @default(cuid())
  stripePaymentLinkId String            @unique @map("stripe_payment_link_id")
  url                 String
  amount              Decimal           @db.Decimal(12, 2)
  description         String?
  status              PaymentLinkStatus @default(ACTIVE)
  expiresAt           DateTime?         @map("expires_at")
  maxUses             Int?              @map("max_uses")
  timesUsed           Int               @default(0) @map("times_used")
  accountId           String?           @map("account_id")
  invoiceId           String?           @map("invoice_id")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  @@index([accountId])
  @@index([status])
  @@map("payment_links")
}

model PaymentSchedule {
  id                   String           @id @default(cuid())
  stripeSubscriptionId String?          @unique @map("stripe_subscription_id")
  name                 String
  amount               Decimal          @db.Decimal(12, 2)
  frequency            PaymentFrequency @default(MONTHLY)
  status               ScheduleStatus   @default(PENDING)
  startDate            DateTime         @map("start_date")
  endDate              DateTime?        @map("end_date")
  nextPaymentDate      DateTime?        @map("next_payment_date")
  lastPaymentDate      DateTime?        @map("last_payment_date")
  totalPayments        Int?             @map("total_payments")
  completedPayments    Int              @default(0) @map("completed_payments")
  accountId            String           @map("account_id")
  invoiceId            String?          @map("invoice_id")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")

  @@index([accountId])
  @@index([status])
  @@index([nextPaymentDate])
  @@map("payment_schedules")
}

model ServiceContract {
  id                        String         @id @default(cuid())
  salesforceId              String?        @unique @map("salesforce_id")
  contractNumber            String         @unique @map("contract_number")
  name                      String
  status                    ContractStatus @default(DRAFT)
  startDate                 DateTime?      @map("start_date")
  endDate                   DateTime?      @map("end_date")
  contractTotal             Decimal        @map("contract_total") @db.Decimal(12, 2)
  salesTotalPrice           Decimal?       @map("sales_total_price") @db.Decimal(12, 2)
  supplementsClosedTotal    Decimal?       @map("supplements_closed_total") @db.Decimal(12, 2)
  supplementsCommissionable Boolean        @default(false) @map("supplements_commissionable")
  collectedPercent          Decimal?       @map("collected_percent") @db.Decimal(5, 2)
  paidAmount                Decimal?       @map("paid_amount") @db.Decimal(12, 2)
  balanceDue                Decimal?       @map("balance_due") @db.Decimal(12, 2)
  preCommissionRate         Decimal?       @map("pre_commission_rate") @db.Decimal(5, 2)
  companyLeadRate           Decimal?       @map("company_lead_rate") @db.Decimal(5, 2)
  selfGenRate               Decimal?       @map("self_gen_rate") @db.Decimal(5, 2)
  commissionRate            Decimal?       @map("commission_rate") @db.Decimal(5, 2)
  x5050Split                Boolean        @default(false) @map("x50_50_split")
  managerId                 String?        @map("manager_id")
  regionalManagerId         String?        @map("regional_manager_id")
  directorId                String?        @map("director_id")
  executiveId               String?        @map("executive_id")
  managerOverride           Decimal?       @map("manager_override") @db.Decimal(5, 2)
  regionalOverride          Decimal?       @map("regional_override") @db.Decimal(5, 2)
  directorOverride          Decimal?       @map("director_override") @db.Decimal(5, 2)
  executiveOverride         Decimal?       @map("executive_override") @db.Decimal(5, 2)
  isPmContract              Boolean        @default(false) @map("is_pm_contract")
  ownerId                   String?        @map("owner_id")
  backEndCommissionReady    Boolean        @default(false) @map("back_end_commission_ready")
  pandaClaimsOnboardedDate  DateTime?      @map("panda_claims_onboarded_date")
  opportunityId             String         @unique @map("opportunity_id")
  accountId                 String         @map("account_id")
  createdAt                 DateTime       @default(now()) @map("created_at")
  updatedAt                 DateTime       @updatedAt @map("updated_at")
  commissions               Commission[]
  invoices                  Invoice[]
  opportunity               Opportunity    @relation(fields: [opportunityId], references: [id])

  @@index([ownerId])
  @@index([managerId])
  @@index([accountId])
  @@map("service_contracts")
}

model Commission {
  id                  String            @id @default(cuid())
  salesforceId        String?           @unique @map("salesforce_id")
  name                String?
  type                CommissionType    @map("commission_type")
  status              CommissionStatus  @default(NEW)
  commissionValue     Decimal           @map("commission_value") @db.Decimal(12, 2)
  commissionRate      Decimal           @map("commission_rate") @db.Decimal(5, 2)
  commissionAmount    Decimal           @map("commission_amount") @db.Decimal(12, 2)
  requestedAmount     Decimal?          @map("requested_amount") @db.Decimal(12, 2)
  preCommissionAmount Decimal?          @map("pre_commission_amount") @db.Decimal(12, 2)
  paidAmount          Decimal?          @map("paid_amount") @db.Decimal(12, 2)
  notes               String?
  holdReason          String?           @map("hold_reason")
  deniedReason        String?           @map("denied_reason")
  isCompanyLead       Boolean           @default(false) @map("is_company_lead")
  isSelfGen           Boolean           @default(false) @map("is_self_gen")
  parentCommissionId  String?           @map("parent_commission_id")
  ownerId             String            @map("owner_id")
  opportunityId       String?           @map("opportunity_id")
  serviceContractId   String?           @map("service_contract_id")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  requestedDate       DateTime?         @map("requested_date")
  approvedDate        DateTime?         @map("approved_date")
  paidDate            DateTime?         @map("paid_date")
  holdDate            DateTime?         @map("hold_date")
  deniedDate          DateTime?         @map("denied_date")
  payroll_update_date DateTime?
  approvalRequests    ApprovalRequest[]
  opportunity         Opportunity?      @relation(fields: [opportunityId], references: [id])
  owner               User              @relation(fields: [ownerId], references: [id])
  parentCommission    Commission?       @relation("PayrollAdjustments", fields: [parentCommissionId], references: [id])
  payrollAdjustments  Commission[]      @relation("PayrollAdjustments")
  serviceContract     ServiceContract?  @relation(fields: [serviceContractId], references: [id])

  @@index([ownerId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@index([serviceContractId])
  @@index([parentCommissionId])
  @@map("commissions")
}

model Message {
  id             String           @id @default(cuid())
  direction      MessageDirection
  channel        MessageChannel
  body           String
  bodyHtml       String?          @map("body_html")
  subject        String?
  mediaUrls      String[]         @map("media_urls")
  status         MessageStatus    @default(QUEUED)
  errorCode      String?          @map("error_code")
  errorMessage   String?          @map("error_message")
  twilioSid      String?          @unique @map("twilio_sid")
  providerId     String?          @map("provider_id")
  providerName   String?          @map("provider_name")
  fromAddress    String?          @map("from_address")
  fromName       String?          @map("from_name")
  toAddresses    String[]         @map("to_addresses")
  ccAddresses    String[]         @map("cc_addresses")
  replyTo        String?          @map("reply_to")
  emailMessageId String?          @unique @map("email_message_id")
  inReplyTo      String?          @map("in_reply_to")
  threadId       String?          @map("thread_id")
  openedAt       DateTime?        @map("opened_at")
  clickedAt      DateTime?        @map("clicked_at")
  bouncedAt      DateTime?        @map("bounced_at")
  bounceType     String?          @map("bounce_type")
  bounceReason   String?          @map("bounce_reason")
  contactId      String?          @map("contact_id")
  conversationId String           @map("conversation_id")
  sentById       String?          @map("sent_by_id")
  createdAt      DateTime         @default(now()) @map("created_at")
  sentAt         DateTime?        @map("sent_at")
  deliveredAt    DateTime?        @map("delivered_at")
  readAt         DateTime?        @map("read_at")
  contact        Contact?         @relation(fields: [contactId], references: [id])
  conversation   Conversation     @relation(fields: [conversationId], references: [id])

  @@index([conversationId])
  @@index([contactId])
  @@index([createdAt])
  @@index([threadId])
  @@index([channel])
  @@map("messages")
}

model Conversation {
  id                  String               @id @default(cuid())
  phoneNumber         String?              @map("phone_number")
  email               String?
  identifier          String               @unique
  channels            MessageChannel[]     @default([])
  status              ConversationStatus   @default(OPEN)
  lastMessageAt       DateTime?            @map("last_message_at")
  lastMessagePreview  String?              @map("last_message_preview")
  lastChannel         MessageChannel?      @map("last_channel")
  unreadCount         Int                  @default(0) @map("unread_count")
  priority            ConversationPriority @default(NORMAL)
  sentiment           String?
  aiSummary           String?              @map("ai_summary")
  needsAttention      Boolean              @default(false) @map("needs_attention")
  attentionReason     String?              @map("attention_reason")
  assignedUserId      String?              @map("assigned_user_id")
  contactId           String?              @map("contact_id")
  opportunityId       String?              @map("opportunity_id")
  accountId           String?              @map("account_id")
  autoResponseEnabled Boolean              @default(true) @map("auto_response_enabled")
  lastAutoResponseAt  DateTime?            @map("last_auto_response_at")
  tags                String[]             @default([])
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  closedAt            DateTime?            @map("closed_at")
  archivedAt          DateTime?            @map("archived_at")
  messages            Message[]

  @@index([contactId])
  @@index([opportunityId])
  @@index([status])
  @@index([assignedUserId])
  @@index([needsAttention])
  @@index([lastMessageAt])
  @@map("conversations")
}

model SystemSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  description String?
  category    String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  createdById String?  @map("created_by_id")
  updatedById String?  @map("updated_by_id")

  @@index([category])
  @@map("system_settings")
}

model User {
  id                                               String                  @id @default(cuid())
  salesforceId                                     String?                 @unique @map("salesforce_id")
  cognitoId                                        String?                 @unique @map("cognito_id")
  email                                            String                  @unique
  firstName                                        String                  @map("first_name")
  lastName                                         String                  @map("last_name")
  fullName                                         String?                 @map("full_name")
  phone                                            String?
  mobilePhone                                      String?                 @map("mobile_phone")
  isActive                                         Boolean                 @default(true) @map("is_active")
  status                                           String?
  roleId                                           String?                 @map("role_id")
  department                                       String?
  division                                         String?
  title                                            String?
  employeeNumber                                   String?                 @map("employee_number")
  officeAssignment                                 String?                 @map("office_assignment")
  startDate                                        DateTime?               @map("start_date")
  street                                           String?
  city                                             String?
  state                                            String?
  postalCode                                       String?                 @map("postal_code")
  country                                          String?
  managerId                                        String?                 @map("manager_id")
  directorId                                       String?                 @map("director_id")
  regionalManagerId                                String?                 @map("regional_manager_id")
  executiveId                                      String?                 @map("executive_id")
  companyLeadRate                                  Decimal?                @map("company_lead_rate") @db.Decimal(5, 2)
  preCommissionRate                                Decimal?                @map("pre_commission_rate") @db.Decimal(5, 2)
  selfGenRate                                      Decimal?                @map("self_gen_rate") @db.Decimal(5, 2)
  commissionRate                                   Decimal?                @map("commission_rate") @db.Decimal(5, 2)
  overridePercent                                  Decimal?                @map("override_percent") @db.Decimal(5, 2)
  supplementsCommissionable                        Boolean                 @default(false) @map("supplements_commissionable")
  x5050CommissionSplit                             Boolean                 @default(false) @map("x50_50_commission_split")
  lastLeadAssignedAt                               DateTime?               @map("last_lead_assigned_at")
  subcontractorAccountId                           String?                 @map("subcontractor_account_id")
  createdAt                                        DateTime                @default(now()) @map("created_at")
  updatedAt                                        DateTime                @updatedAt @map("updated_at")
  lastLoginAt                                      DateTime?               @map("last_login_at")
  google_calendar_email                            String?
  google_calendar_last_sync_at                     DateTime?
  google_calendar_sync_enabled                     Boolean                 @default(false)
  ownedAccounts                                    Account[]               @relation("AccountOwner")
  activities                                       Activity[]              @relation("UserActivities")
  agreements_agreements_created_by_idTousers       Agreement[]             @relation("agreements_created_by_idTousers")
  agreements_agreements_sent_by_idTousers          Agreement[]             @relation("agreements_sent_by_idTousers")
  approvalComments                                 ApprovalComment[]
  approvalRequestsToApprove                        ApprovalRequest[]       @relation("ApprovalApprover")
  approvalRequestsDecided                          ApprovalRequest[]       @relation("ApprovalDecider")
  approvalRequestsEscalated                        ApprovalRequest[]       @relation("EscalatedApprovals")
  approvalRequestsSubmitted                        ApprovalRequest[]       @relation("ApprovalRequester")
  approvalStepsAssigned                            ApprovalStep[]
  assignedAttentionItems                           AttentionItem[]         @relation("AssignedAttentionItems")
  dismissedAttentionItems                          AttentionItem[]         @relation("DismissedAttentionItems")
  call_campaigns                                   call_campaigns[]
  assignedCallItems                                CallListItem[]          @relation("CallListItemAssignedTo")
  assignedCallLists                                CallList[]              @relation("CallListAssignedUser")
  createdCallLists                                 CallList[]              @relation("CallListCreatedBy")
  callLogs                                         CallLog[]
  callSessions                                     CallSession[]           @relation("UserCallSessions")
  commissions                                      Commission[]
  custom_fields                                    custom_fields[]
  sentEmailMessages                                EmailMessage[]          @relation("EmailSender")
  ownedEmailTemplates                              EmailTemplate[]         @relation("EmailTemplateOwner")
  emailsSent                                       Email[]                 @relation("EmailsSent")
  ownedEvents                                      Event[]                 @relation("EventOwner")
  help_articles_help_articles_created_by_idTousers help_articles[]         @relation("help_articles_created_by_idTousers")
  help_articles_help_articles_updated_by_idTousers help_articles[]         @relation("help_articles_updated_by_idTousers")
  leadsAssignedBy                                  LeadAssignmentLog[]     @relation("AssignedByUser")
  leadsAssignedTo                                  LeadAssignmentLog[]     @relation("AssignedToUser")
  assignmentRulesAssignedTo                        LeadAssignmentRule[]    @relation("RuleAssignToUser")
  assignmentRulesCreated                           LeadAssignmentRule[]    @relation("RuleCreatedBy")
  leadsSetBy                                       Lead[]                  @relation("LeadSetByUser")
  ownedLeads                                       Lead[]                  @relation("LeadOwner")
  materialOrdersPlaced                             MaterialOrder[]         @relation("MaterialOrdersPlaced")
  measurementReportsOrdered                        MeasurementReport[]
  mobileActivities                                 MobileActivity[]
  mobileSessions                                   MobileSession[]
  createdNotes                                     Note[]                  @relation("NoteCreator")
  notificationPreferences                          NotificationPreference? @relation("UserNotificationPreferences")
  notifications                                    Notification[]          @relation("UserNotifications")
  ownedOpportunities                               Opportunity[]           @relation("OpportunityOwner")
  projectManagedOpportunities                      Opportunity[]           @relation("OpportunityProjectManager")
  page_layouts                                     page_layouts[]
  push_tokens                                      push_tokens[]
  quotes                                           Quote[]
  createdReports                                   SavedReport[]           @relation("ReportCreator")
  scheduleOptimizationsApproved                    ScheduleOptimization[]
  serviceResource                                  ServiceResource?
  assignedTasks                                    Task[]                  @relation("TaskAssignee")
  teamMemberships                                  TeamMember[]
  teamsLed                                         Team[]                  @relation("TeamLeader")
  territoriesOwned                                 Territory[]             @relation("TerritoryOwner")
  director                                         User?                   @relation("UserDirector", fields: [directorId], references: [id])
  directorReports                                  User[]                  @relation("UserDirector")
  executive                                        User?                   @relation("UserExecutive", fields: [executiveId], references: [id])
  executiveReports                                 User[]                  @relation("UserExecutive")
  manager                                          User?                   @relation("UserManager", fields: [managerId], references: [id])
  directReports                                    User[]                  @relation("UserManager")
  regionalManager                                  User?                   @relation("UserRegionalManager", fields: [regionalManagerId], references: [id])
  regionalReports                                  User[]                  @relation("UserRegionalManager")
  role                                             Role?                   @relation(fields: [roleId], references: [id])
  validation_rules                                 validation_rules[]

  @@index([managerId])
  @@index([directorId])
  @@index([officeAssignment])
  @@index([department])
  @@map("users")
}

model Role {
  id              String           @id @default(cuid())
  name            String           @unique
  description     String?
  permissionsJson Json             @default("{}") @map("permissions")
  createdAt       DateTime         @default(now()) @map("created_at")
  isActive        Boolean          @default(true) @map("is_active")
  parentId        String?          @map("parent_id")
  roleType        String?          @map("role_type")
  salesforceId    String?          @unique @map("salesforce_id")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  rolePermissions RolePermission[]
  parent          Role?            @relation("RoleHierarchy", fields: [parentId], references: [id])
  children        Role[]           @relation("RoleHierarchy")
  users           User[]

  @@index([roleType])
  @@index([parentId])
  @@map("roles")
}

model Case {
  id             String          @id @default(cuid())
  salesforceId   String?         @unique @map("salesforce_id")
  caseNumber     String          @unique @map("case_number")
  subject        String
  description    String?
  status         CaseStatus      @default(NEW)
  priority       Priority        @default(NORMAL)
  type           String?
  accountId      String?         @map("account_id")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  closedAt       DateTime?       @map("closed_at")
  attentionItems AttentionItem[] @relation("CaseAttentionItems")
  account        Account?        @relation(fields: [accountId], references: [id])
  notifications  Notification[]  @relation("CaseNotifications")

  @@index([accountId])
  @@index([status])
  @@map("cases")
}

model Email {
  id              String           @id @default(cuid())
  fromAddress     String           @map("from_address")
  fromName        String?          @map("from_name")
  toAddresses     String[]         @map("to_addresses")
  ccAddresses     String[]         @map("cc_addresses")
  bccAddresses    String[]         @map("bcc_addresses")
  replyTo         String?          @map("reply_to")
  subject         String
  bodyText        String?          @map("body_text")
  bodyHtml        String?          @map("body_html")
  status          EmailStatus      @default(DRAFT)
  direction       MessageDirection @default(OUTBOUND)
  providerId      String?          @map("provider_id")
  providerName    String?          @map("provider_name")
  sentAt          DateTime?        @map("sent_at")
  deliveredAt     DateTime?        @map("delivered_at")
  openedAt        DateTime?        @map("opened_at")
  clickedAt       DateTime?        @map("clicked_at")
  bouncedAt       DateTime?        @map("bounced_at")
  complainedAt    DateTime?        @map("complained_at")
  unsubscribedAt  DateTime?        @map("unsubscribed_at")
  bounceType      String?          @map("bounce_type")
  bounceReason    String?          @map("bounce_reason")
  messageId       String?          @unique @map("message_id")
  inReplyTo       String?          @map("in_reply_to")
  threadId        String?          @map("thread_id")
  attachmentUrls  String[]         @map("attachment_urls")
  attachmentCount Int              @default(0) @map("attachment_count")
  contactId       String?          @map("contact_id")
  opportunityId   String?          @map("opportunity_id")
  accountId       String?          @map("account_id")
  leadId          String?          @map("lead_id")
  sentById        String?          @map("sent_by_id")
  scheduledAt     DateTime?        @map("scheduled_at")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  account         Account?         @relation("AccountEmails", fields: [accountId], references: [id])
  contact         Contact?         @relation("ContactEmails", fields: [contactId], references: [id])
  lead            Lead?            @relation("LeadEmails", fields: [leadId], references: [id])
  opportunity     Opportunity?     @relation("OpportunityEmails", fields: [opportunityId], references: [id])
  sentBy          User?            @relation("EmailsSent", fields: [sentById], references: [id])

  @@index([contactId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([leadId])
  @@index([status])
  @@index([threadId])
  @@index([createdAt])
  @@map("emails")
}

model Note {
  id            String       @id @default(cuid())
  title         String?
  body          String
  accountId     String?      @map("account_id")
  contactId     String?      @map("contact_id")
  leadId        String?      @map("lead_id")
  opportunityId String?      @map("opportunity_id")
  createdById   String       @map("created_by_id")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  account       Account?     @relation("AccountNotes", fields: [accountId], references: [id])
  contact       Contact?     @relation("ContactNotes", fields: [contactId], references: [id])
  createdBy     User         @relation("NoteCreator", fields: [createdById], references: [id])
  lead          Lead?        @relation("LeadNotes", fields: [leadId], references: [id])
  opportunity   Opportunity? @relation("OpportunityNotes", fields: [opportunityId], references: [id])

  @@map("notes")
}

model Task {
  id            String       @id @default(cuid())
  salesforceId  String?      @unique @map("salesforce_id")
  subject       String
  description   String?
  status        TaskStatus   @default(NOT_STARTED)
  priority      Priority     @default(NORMAL)
  dueDate       DateTime?    @map("due_date")
  completedDate DateTime?    @map("completed_date")
  assignedToId  String?      @map("assigned_to_id")
  leadId        String?      @map("lead_id")
  opportunityId String?      @map("opportunity_id")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  assignedTo    User?        @relation("TaskAssignee", fields: [assignedToId], references: [id])
  lead          Lead?        @relation("LeadTasks", fields: [leadId], references: [id])
  opportunity   Opportunity? @relation("OpportunityTasks", fields: [opportunityId], references: [id])

  @@index([assignedToId])
  @@index([status])
  @@index([dueDate])
  @@map("tasks")
}

model Event {
  id                  String       @id @default(cuid())
  salesforceId        String?      @unique @map("salesforce_id")
  googleEventId       String?      @unique @map("google_event_id")
  subject             String
  description         String?
  location            String?
  startDateTime       DateTime     @map("start_date_time")
  endDateTime         DateTime     @map("end_date_time")
  isAllDay            Boolean      @default(false) @map("is_all_day")
  timeZone            String?      @map("time_zone")
  isRecurring         Boolean      @default(false) @map("is_recurring")
  recurrenceRule      String?      @map("recurrence_rule")
  recurrenceEndDate   DateTime?    @map("recurrence_end_date")
  videoConferenceUrl  String?      @map("video_conference_url")
  videoConferenceType String?      @map("video_conference_type")
  ownerId             String       @map("owner_id")
  leadId              String?      @map("lead_id")
  opportunityId       String?      @map("opportunity_id")
  accountId           String?      @map("account_id")
  contactId           String?      @map("contact_id")
  status              EventStatus  @default(SCHEDULED)
  showAs              EventShowAs  @default(BUSY)
  reminderMinutes     Int?         @map("reminder_minutes")
  reminderSent        Boolean      @default(false) @map("reminder_sent")
  attendees           Json?
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")
  account             Account?     @relation("AccountEvents", fields: [accountId], references: [id])
  contact             Contact?     @relation("ContactEvents", fields: [contactId], references: [id])
  lead                Lead?        @relation("LeadEvents", fields: [leadId], references: [id])
  opportunity         Opportunity? @relation("OpportunityEvents", fields: [opportunityId], references: [id])
  owner               User         @relation("EventOwner", fields: [ownerId], references: [id])

  @@index([ownerId])
  @@index([startDateTime])
  @@index([opportunityId])
  @@index([accountId])
  @@map("events")
}

model EmailMessage {
  id             String         @id @default(cuid())
  salesforceId   String?        @unique @map("salesforce_id")
  messageId      String?        @unique @map("message_id")
  subject        String?
  textBody       String?        @map("text_body")
  htmlBody       String?        @map("html_body")
  fromAddress    String         @map("from_address")
  fromName       String?        @map("from_name")
  toAddresses    String[]       @map("to_addresses")
  ccAddresses    String[]       @map("cc_addresses")
  bccAddresses   String[]       @map("bcc_addresses")
  replyToAddress String?        @map("reply_to_address")
  threadId       String?        @map("thread_id")
  inReplyTo      String?        @map("in_reply_to")
  parentId       String?        @map("parent_id")
  direction      EmailDirection @default(OUTBOUND)
  status         EmailStatus    @default(SENT)
  sentAt         DateTime?      @map("sent_at")
  receivedAt     DateTime?      @map("received_at")
  openedAt       DateTime?      @map("opened_at")
  clickedAt      DateTime?      @map("clicked_at")
  bouncedAt      DateTime?      @map("bounced_at")
  bounceReason   String?        @map("bounce_reason")
  openCount      Int            @default(0) @map("open_count")
  clickCount     Int            @default(0) @map("click_count")
  hasAttachments Boolean        @default(false) @map("has_attachments")
  leadId         String?        @map("lead_id")
  opportunityId  String?        @map("opportunity_id")
  accountId      String?        @map("account_id")
  contactId      String?        @map("contact_id")
  senderId       String?        @map("sender_id")
  templateId     String?        @map("template_id")
  attachments    Json?
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  account        Account?       @relation("AccountEmails", fields: [accountId], references: [id])
  contact        Contact?       @relation("ContactEmails", fields: [contactId], references: [id])
  lead           Lead?          @relation("LeadEmails", fields: [leadId], references: [id])
  opportunity    Opportunity?   @relation("OpportunityEmails", fields: [opportunityId], references: [id])
  parent         EmailMessage?  @relation("EmailThread", fields: [parentId], references: [id])
  replies        EmailMessage[] @relation("EmailThread")
  sender         User?          @relation("EmailSender", fields: [senderId], references: [id])
  template       EmailTemplate? @relation(fields: [templateId], references: [id])

  @@index([fromAddress])
  @@index([threadId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([contactId])
  @@index([sentAt])
  @@map("email_messages")
}

model EmailTemplate {
  id           String         @id @default(cuid())
  salesforceId String?        @unique @map("salesforce_id")
  name         String
  subject      String
  htmlBody     String         @map("html_body")
  textBody     String?        @map("text_body")
  category     String?
  isActive     Boolean        @default(true) @map("is_active")
  isPublic     Boolean        @default(false) @map("is_public")
  mergeFields  String[]       @map("merge_fields")
  ownerId      String?        @map("owner_id")
  usageCount   Int            @default(0) @map("usage_count")
  lastUsedAt   DateTime?      @map("last_used_at")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  emails       EmailMessage[]
  owner        User?          @relation("EmailTemplateOwner", fields: [ownerId], references: [id])

  @@index([category])
  @@index([isActive])
  @@map("email_templates")
}

model Campaign {
  id                  String           @id @default(cuid())
  name                String
  description         String?
  type                CampaignType     @default(SMS)
  status              CampaignStatus   @default(DRAFT)
  audienceRules       Json?            @map("audience_rules")
  estimatedRecipients Int              @default(0) @map("estimated_recipients")
  subject             String?
  body                String?
  templateId          String?          @map("template_id")
  sendSchedule        SendSchedule     @default(IMMEDIATE) @map("send_schedule")
  scheduledAt         DateTime?        @map("scheduled_at")
  sentAt              DateTime?        @map("sent_at")
  totalSent           Int              @default(0) @map("total_sent")
  delivered           Int              @default(0)
  failed              Int              @default(0)
  opened              Int              @default(0)
  clicked             Int              @default(0)
  optedOut            Int              @default(0) @map("opted_out")
  createdById         String           @map("created_by_id")
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  sends               CampaignSend[]
  template            MessageTemplate? @relation(fields: [templateId], references: [id])

  @@index([status])
  @@index([type])
  @@map("campaigns")
}

model CampaignSend {
  id           String        @id @default(cuid())
  campaignId   String        @map("campaign_id")
  contactId    String?       @map("contact_id")
  phone        String?
  email        String?
  status       MessageStatus @default(QUEUED)
  errorCode    String?       @map("error_code")
  errorMessage String?       @map("error_message")
  externalId   String?       @map("external_id")
  deliveredAt  DateTime?     @map("delivered_at")
  openedAt     DateTime?     @map("opened_at")
  clickedAt    DateTime?     @map("clicked_at")
  createdAt    DateTime      @default(now()) @map("created_at")
  campaign     Campaign      @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([status])
  @@map("campaign_sends")
}

model MessageTemplate {
  id                String             @id @default(cuid())
  name              String
  description       String?
  type              CampaignType       @default(SMS)
  category          String?
  subject           String?
  body              String
  variables         String[]           @default([])
  isActive          Boolean            @default(true) @map("is_active")
  isSystem          Boolean            @default(false) @map("is_system")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  campaigns         Campaign[]
  scheduledMessages ScheduledMessage[]
  workflowActions   WorkflowAction[]

  @@map("message_templates")
}

model ScheduledMessage {
  id                String                 @id @default(cuid())
  contactId         String?                @map("contact_id")
  phone             String?
  email             String?
  opportunityId     String?                @map("opportunity_id")
  accountId         String?                @map("account_id")
  workOrderId       String?                @map("work_order_id")
  templateId        String?                @map("template_id")
  customBody        String?                @map("custom_body")
  channel           MessageChannel         @default(SMS)
  scheduledFor      DateTime               @map("scheduled_for")
  status            ScheduledMessageStatus @default(PENDING)
  sentAt            DateTime?              @map("sent_at")
  messageId         String?                @map("message_id")
  errorMessage      String?                @map("error_message")
  workflowTriggerId String?                @map("workflow_trigger_id")
  createdAt         DateTime               @default(now()) @map("created_at")
  template          MessageTemplate?       @relation(fields: [templateId], references: [id])

  @@index([scheduledFor])
  @@index([status])
  @@map("scheduled_messages")
}

model Agreement {
  id                                    String             @id @default(cuid())
  agreementNumber                       String             @unique @map("agreement_number")
  name                                  String
  status                                AgreementStatus    @default(DRAFT)
  templateId                            String?            @map("template_id")
  opportunityId                         String?            @map("opportunity_id")
  accountId                             String?            @map("account_id")
  contactId                             String?            @map("contact_id")
  documentUrl                           String?            @map("document_url")
  signedDocumentUrl                     String?            @map("signed_document_url")
  expiresAt                             DateTime?          @map("expires_at")
  sentAt                                DateTime?          @map("sent_at")
  viewedAt                              DateTime?          @map("viewed_at")
  signedAt                              DateTime?          @map("signed_at")
  declinedAt                            DateTime?          @map("declined_at")
  declineReason                         String?            @map("decline_reason")
  pandaSignId                           String?            @unique @map("pandasign_id")
  signingToken                          String?            @unique @map("signing_token")
  signingUrl                            String?            @map("signing_url")
  mergeData                             Json?              @map("merge_data")
  createdAt                             DateTime           @default(now()) @map("created_at")
  updatedAt                             DateTime           @updatedAt @map("updated_at")
  completed_at                          DateTime?
  created_by_id                         String?
  host_signed_at                        DateTime?
  host_signer_email                     String?
  host_signer_name                      String?
  host_signing_initiated_at             DateTime?
  host_signing_initiated_by_id          String?
  host_signing_token                    String?            @unique
  recipient_email                       String?
  recipient_name                        String?
  sent_by_id                            String?
  void_reason                           String?
  voided_at                             DateTime?
  voided_by_id                          String?
  accounts                              Account?           @relation(fields: [accountId], references: [id])
  contacts                              Contact?           @relation(fields: [contactId], references: [id])
  users_agreements_created_by_idTousers User?              @relation("agreements_created_by_idTousers", fields: [created_by_id], references: [id])
  opportunities                         Opportunity?       @relation(fields: [opportunityId], references: [id])
  users_agreements_sent_by_idTousers    User?              @relation("agreements_sent_by_idTousers", fields: [sent_by_id], references: [id])
  template                              AgreementTemplate? @relation(fields: [templateId], references: [id])
  signatures                            Signature[]

  @@index([status])
  @@index([opportunityId])
  @@index([accountId])
  @@index([host_signing_token])
  @@map("agreements")
}

model AgreementTemplate {
  id              String      @id @default(cuid())
  name            String
  description     String?
  category        String?
  documentUrl     String?     @map("document_url")
  content         String?
  signatureFields Json?       @map("signature_fields")
  mergeFields     String[]    @default([]) @map("merge_fields")
  isActive        Boolean     @default(true) @map("is_active")
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")
  agreements      Agreement[]

  @@map("agreement_templates")
}

model Signature {
  id                String          @id @default(cuid())
  agreementId       String          @map("agreement_id")
  signerName        String          @map("signer_name")
  signerEmail       String?         @map("signer_email")
  signerRole        SignerRole      @default(CUSTOMER) @map("signer_role")
  status            SignatureStatus @default(PENDING)
  signatureImageUrl String?         @map("signature_image_url")
  ipAddress         String?         @map("ip_address")
  userAgent         String?         @map("user_agent")
  sentAt            DateTime?       @map("sent_at")
  viewedAt          DateTime?       @map("viewed_at")
  signedAt          DateTime?       @map("signed_at")
  signature_type    String?
  signature_url     String?
  signer_type       String?
  agreement         Agreement       @relation(fields: [agreementId], references: [id], onDelete: Cascade)

  @@index([agreementId])
  @@index([signer_type])
  @@map("signatures")
}

model File {
  id            String        @id @default(cuid())
  name          String
  originalName  String        @map("original_name")
  mimeType      String        @map("mime_type")
  size          Int
  storageKey    String        @unique @map("storage_key")
  url           String?
  thumbnailUrl  String?       @map("thumbnail_url")
  accountId     String?       @map("account_id")
  opportunityId String?       @map("opportunity_id")
  workOrderId   String?       @map("work_order_id")
  galleryId     String?       @map("gallery_id")
  category      FileCategory?
  description   String?
  uploadedById  String        @map("uploaded_by_id")
  createdAt     DateTime      @default(now()) @map("created_at")
  gallery       Gallery?      @relation(fields: [galleryId], references: [id])

  @@index([accountId])
  @@index([opportunityId])
  @@index([galleryId])
  @@map("files")
}

model Gallery {
  id                  String    @id @default(cuid())
  name                String?
  description         String?
  opportunityId       String?   @map("opportunity_id")
  accountId           String?   @map("account_id")
  workOrderId         String?   @map("work_order_id")
  publicToken         String?   @unique @map("public_token")
  isPublic            Boolean   @default(false) @map("is_public")
  expiresAt           DateTime? @map("expires_at")
  companyCamProjectId String?   @map("companycam_project_id")
  lastSyncedAt        DateTime? @map("last_synced_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  files               File[]

  @@index([opportunityId])
  @@index([publicToken])
  @@map("galleries")
}

model Workflow {
  id                String              @id @default(cuid())
  name              String
  description       String?
  triggerObject     String              @map("trigger_object")
  triggerEvent      TriggerEvent        @map("trigger_event")
  triggerConditions Json?               @map("trigger_conditions")
  isActive          Boolean             @default(false) @map("is_active")
  version           Int                 @default(1)
  lastExecutedAt    DateTime?           @map("last_executed_at")
  executionCount    Int                 @default(0) @map("execution_count")
  errorCount        Int                 @default(0) @map("error_count")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  createdById       String              @map("created_by_id")
  actions           WorkflowAction[]
  executions        WorkflowExecution[]

  @@index([triggerObject])
  @@index([isActive])
  @@map("workflows")
}

model WorkflowAction {
  id                String             @id @default(cuid())
  workflowId        String             @map("workflow_id")
  actionType        WorkflowActionType @map("action_type")
  actionOrder       Int                @map("action_order")
  updateField       String?            @map("update_field")
  updateValue       String?            @map("update_value")
  messageTemplateId String?            @map("message_template_id")
  messageChannel    MessageChannel?    @map("message_channel")
  delayMinutes      Int?               @map("delay_minutes")
  createRecordType  String?            @map("create_record_type")
  createRecordData  Json?              @map("create_record_data")
  webhookUrl        String?            @map("webhook_url")
  webhookMethod     String?            @map("webhook_method")
  webhookHeaders    Json?              @map("webhook_headers")
  webhookBody       Json?              @map("webhook_body")
  condition         Json?
  messageTemplate   MessageTemplate?   @relation(fields: [messageTemplateId], references: [id])
  workflow          Workflow           @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
  @@map("workflow_actions")
}

model WorkflowExecution {
  id                String                  @id @default(cuid())
  workflowId        String                  @map("workflow_id")
  triggerRecordId   String                  @map("trigger_record_id")
  triggerRecordType String                  @map("trigger_record_type")
  triggerData       Json?                   @map("trigger_data")
  status            WorkflowExecutionStatus @default(PENDING)
  startedAt         DateTime?               @map("started_at")
  completedAt       DateTime?               @map("completed_at")
  actionsExecuted   Int                     @default(0) @map("actions_executed")
  errorMessage      String?                 @map("error_message")
  executionLog      Json?                   @map("execution_log")
  createdAt         DateTime                @default(now()) @map("created_at")
  workflow          Workflow                @relation(fields: [workflowId], references: [id])

  @@index([workflowId])
  @@index([status])
  @@index([triggerRecordId])
  @@map("workflow_executions")
}

model AuditLog {
  id            String      @id @default(cuid())
  tableName     String      @map("table_name")
  recordId      String      @map("record_id")
  action        AuditAction
  oldValues     Json?       @map("old_values")
  newValues     Json?       @map("new_values")
  changedFields String[]    @default([]) @map("changed_fields")
  userId        String?     @map("user_id")
  userEmail     String?     @map("user_email")
  ipAddress     String?     @map("ip_address")
  userAgent     String?     @map("user_agent")
  source        String?
  workflowId    String?     @map("workflow_id")
  createdAt     DateTime    @default(now()) @map("created_at")

  @@index([tableName, recordId])
  @@index([userId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Permission {
  id              String           @id @default(cuid())
  name            String           @unique
  description     String?
  resource        String
  action          PermissionAction
  conditions      Json?
  rolePermissions RolePermission[]

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(cuid())
  roleId       String     @map("role_id")
  permissionId String     @map("permission_id")
  conditions   Json?
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model CommissionRule {
  id                  String             @id @default(cuid())
  name                String
  description         String?
  ruleType            CommissionRuleType @default(PERCENTAGE) @map("rule_type")
  rate                Decimal?           @db.Decimal(5, 2)
  flatAmount          Decimal?           @map("flat_amount") @db.Decimal(12, 2)
  commissionType      CommissionType?    @map("commission_type")
  isActive            Boolean            @default(true) @map("is_active")
  priority            Int                @default(0)
  conditions          Json?
  appliesToRole       String?            @map("applies_to_role")
  appliesToDepartment String?            @map("applies_to_department")
  appliesToUserId     String?            @map("applies_to_user_id")
  createdAt           DateTime           @default(now()) @map("created_at")
  updatedAt           DateTime           @updatedAt @map("updated_at")
  createdById         String?            @map("created_by_id")

  @@index([isActive])
  @@index([commissionType])
  @@index([ruleType])
  @@map("commission_rules")
}

model CommissionPlan {
  id                  String           @id @default(cuid())
  name                String
  description         String?
  isActive            Boolean          @default(true) @map("is_active")
  effectiveDate       DateTime         @map("effective_date")
  expirationDate      DateTime?        @map("expiration_date")
  appliesToRole       String?          @map("applies_to_role")
  appliesToDepartment String?          @map("applies_to_department")
  appliesToUserId     String?          @map("applies_to_user_id")
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  tiers               CommissionTier[]

  @@map("commission_plans")
}

model CommissionTier {
  id                String             @id @default(cuid())
  planId            String             @map("plan_id")
  name              String
  minAmount         Decimal?           @map("min_amount") @db.Decimal(12, 2)
  maxAmount         Decimal?           @map("max_amount") @db.Decimal(12, 2)
  commissionType    CommissionCalcType @map("commission_type")
  rate              Decimal            @db.Decimal(5, 4)
  flatAmount        Decimal?           @map("flat_amount") @db.Decimal(12, 2)
  triggerEvent      CommissionTrigger  @map("trigger_event")
  triggerConditions Json?              @map("trigger_conditions")
  tierOrder         Int                @map("tier_order")
  plan              CommissionPlan     @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@map("commission_tiers")
}

model CompanyCamProject {
  id                String            @id @default(cuid())
  companyCamId      String            @unique @map("companycam_id")
  name              String
  opportunityId     String?           @unique @map("opportunity_id")
  accountId         String?           @map("account_id")
  address           String?
  latitude          Float?
  longitude         Float?
  photoCount        Int               @default(0) @map("photo_count")
  lastPhotoAt       DateTime?         @map("last_photo_at")
  lastSyncedAt      DateTime?         @map("last_synced_at")
  syncStatus        SyncStatus        @default(PENDING) @map("sync_status")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  companycam_photos CompanyCamPhoto[]
  accounts          Account?          @relation(fields: [accountId], references: [id])
  opportunities     Opportunity?      @relation(fields: [opportunityId], references: [id])

  @@map("companycam_projects")
}

model CompanyCamPhoto {
  id                  String            @id @default(cuid())
  companyCamId        String            @unique @map("companycam_id")
  projectId           String            @map("project_id")
  photoUrl            String            @map("photo_url")
  thumbnailUrl        String?           @map("thumbnail_url")
  caption             String?
  takenAt             DateTime?         @map("taken_at")
  latitude            Float?
  longitude           Float?
  tags                String[]          @default([])
  createdAt           DateTime          @default(now()) @map("created_at")
  companycam_projects CompanyCamProject @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@map("companycam_photos")
}

model GoogleCalendarSync {
  id                String     @id @default(cuid())
  serviceResourceId String     @unique @map("service_resource_id")
  accessToken       String     @map("access_token")
  refreshToken      String     @map("refresh_token")
  tokenExpiry       DateTime   @map("token_expiry")
  calendarId        String     @map("calendar_id")
  syncEnabled       Boolean    @default(true) @map("sync_enabled")
  lastSyncToken     String?    @map("last_sync_token")
  lastSyncedAt      DateTime?  @map("last_synced_at")
  syncStatus        SyncStatus @default(PENDING) @map("sync_status")
  syncError         String?    @map("sync_error")
  createdAt         DateTime   @default(now()) @map("created_at")
  updatedAt         DateTime   @updatedAt @map("updated_at")

  @@map("google_calendar_syncs")
}

model SavedReport {
  id               String            @id @default(cuid())
  name             String
  description      String?
  category         ReportCategory    @default(CUSTOM)
  reportType       String            @map("report_type")
  chartType        ChartType         @default(TABLE) @map("chart_type")
  baseObject       String?           @map("base_object")
  selectedFields   String[]          @default([]) @map("selected_fields")
  groupByFields    String[]          @default([]) @map("group_by_fields")
  sortBy           String?           @map("sort_by")
  sortDirection    String?           @map("sort_direction")
  filters          Json?
  dateRangeField   String?           @map("date_range_field")
  defaultDateRange String?           @map("default_date_range")
  aggregations     Json?
  isPublic         Boolean           @default(false) @map("is_public")
  sharedWithRoles  String[]          @default([]) @map("shared_with_roles")
  createdById      String            @map("created_by_id")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  lastRunAt        DateTime?         @map("last_run_at")
  base_module      String?
  dashboardWidgets DashboardWidget[]
  favorites        ReportFavorite[]
  createdBy        User              @relation("ReportCreator", fields: [createdById], references: [id])

  @@index([createdById])
  @@index([category])
  @@index([isPublic])
  @@map("saved_reports")
}

model ReportFavorite {
  id        String      @id @default(cuid())
  reportId  String      @map("report_id")
  userId    String      @map("user_id")
  createdAt DateTime    @default(now()) @map("created_at")
  report    SavedReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@unique([reportId, userId])
  @@map("report_favorites")
}

model Dashboard {
  id               String            @id @default(cuid())
  name             String
  description      String?
  layout           DashboardLayout   @default(GRID)
  columns          Int               @default(2)
  defaultDateRange String?           @map("default_date_range")
  isDefault        Boolean           @default(false) @map("is_default")
  isPublic         Boolean           @default(false) @map("is_public")
  sharedWithRoles  String[]          @default([]) @map("shared_with_roles")
  createdById      String            @map("created_by_id")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  widgets          DashboardWidget[]

  @@index([createdById])
  @@index([isDefault])
  @@map("dashboards")
}

model DashboardWidget {
  id                String       @id @default(cuid())
  dashboardId       String       @map("dashboard_id")
  widgetType        WidgetType   @map("widget_type")
  title             String
  subtitle          String?
  positionX         Int          @default(0) @map("position_x")
  positionY         Int          @default(0) @map("position_y")
  width             Int          @default(1)
  height            Int          @default(1)
  savedReportId     String?      @map("saved_report_id")
  dataSource        String?      @map("data_source")
  metricField       String?      @map("metric_field")
  metricFunction    String?      @map("metric_function")
  groupByField      String?      @map("group_by_field")
  filters           Json?
  comparisonEnabled Boolean      @default(false) @map("comparison_enabled")
  comparisonType    String?      @map("comparison_type")
  formatType        String?      @map("format_type")
  iconName          String?      @map("icon_name")
  iconColor         String?      @map("icon_color")
  chartConfig       Json?        @map("chart_config")
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime     @updatedAt @map("updated_at")
  dashboard         Dashboard    @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  savedReport       SavedReport? @relation(fields: [savedReportId], references: [id])

  @@index([dashboardId])
  @@map("dashboard_widgets")
}

model LeadAssignmentRule {
  id                      String              @id @default(cuid())
  name                    String
  description             String?
  isActive                Boolean             @default(true) @map("is_active")
  priority                Int                 @default(0)
  workType                String?             @map("work_type")
  stage                   String?
  status                  String?
  leadSource              String?             @map("lead_source")
  state                   String?
  conditions              Json?
  assignmentType          AssignmentType      @default(ROUND_ROBIN) @map("assignment_type")
  assignToUserId          String?             @map("assign_to_user_id")
  assignToTeamId          String?             @map("assign_to_team_id")
  roundRobinGroup         String?             @map("round_robin_group")
  autoCreateOpportunity   Boolean             @default(false) @map("auto_create_opportunity")
  defaultOpportunityStage String?             @map("default_opportunity_stage")
  notifyAssignee          Boolean             @default(true) @map("notify_assignee")
  notificationTemplate    String?             @map("notification_template")
  createdById             String?             @map("created_by_id")
  createdAt               DateTime            @default(now()) @map("created_at")
  updatedAt               DateTime            @updatedAt @map("updated_at")
  assignmentLogs          LeadAssignmentLog[]
  assignToTeam            Team?               @relation("RuleAssignToTeam", fields: [assignToTeamId], references: [id])
  assignToUser            User?               @relation("RuleAssignToUser", fields: [assignToUserId], references: [id])
  createdBy               User?               @relation("RuleCreatedBy", fields: [createdById], references: [id])

  @@index([isActive])
  @@index([priority])
  @@index([workType])
  @@map("lead_assignment_rules")
}

model LeadAssignmentLog {
  id              String              @id @default(cuid())
  leadId          String              @map("lead_id")
  ruleId          String?             @map("rule_id")
  assignedToId    String              @map("assigned_to_id")
  assignedById    String?             @map("assigned_by_id")
  previousOwnerId String?             @map("previous_owner_id")
  assignmentType  AssignmentType      @map("assignment_type")
  notes           String?
  metadata        Json?
  createdAt       DateTime            @default(now()) @map("created_at")
  assignedBy      User?               @relation("AssignedByUser", fields: [assignedById], references: [id])
  assignedTo      User                @relation("AssignedToUser", fields: [assignedToId], references: [id])
  lead            Lead                @relation(fields: [leadId], references: [id])
  rule            LeadAssignmentRule? @relation(fields: [ruleId], references: [id])

  @@index([leadId])
  @@index([assignedToId])
  @@index([createdAt])
  @@map("lead_assignment_logs")
}

model Team {
  id              String               @id @default(cuid())
  name            String
  description     String?
  isActive        Boolean              @default(true) @map("is_active")
  leaderId        String?              @map("leader_id")
  createdAt       DateTime             @default(now()) @map("created_at")
  updatedAt       DateTime             @updatedAt @map("updated_at")
  assignmentRules LeadAssignmentRule[] @relation("RuleAssignToTeam")
  members         TeamMember[]
  leader          User?                @relation("TeamLeader", fields: [leaderId], references: [id])

  @@map("teams")
}

model TeamMember {
  id       String   @id @default(cuid())
  teamId   String   @map("team_id")
  userId   String   @map("user_id")
  role     TeamRole @default(MEMBER)
  joinedAt DateTime @default(now()) @map("joined_at")
  team     Team     @relation(fields: [teamId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([teamId, userId])
  @@map("team_members")
}

model Territory {
  id          String   @id @default(cuid())
  name        String
  description String?
  states      String[]
  isActive    Boolean  @default(true) @map("is_active")
  ownerId     String?  @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  owner       User?    @relation("TerritoryOwner", fields: [ownerId], references: [id])

  @@map("territories")
}

model Notification {
  id            String               @id @default(cuid())
  userId        String               @map("user_id")
  type          NotificationType
  title         String
  message       String
  priority      NotificationPriority @default(NORMAL)
  actionUrl     String?              @map("action_url")
  actionLabel   String?              @map("action_label")
  opportunityId String?              @map("opportunity_id")
  accountId     String?              @map("account_id")
  contactId     String?              @map("contact_id")
  leadId        String?              @map("lead_id")
  workOrderId   String?              @map("work_order_id")
  caseId        String?              @map("case_id")
  status        NotificationStatus   @default(UNREAD)
  readAt        DateTime?            @map("read_at")
  archivedAt    DateTime?            @map("archived_at")
  sourceType    String?              @map("source_type")
  sourceId      String?              @map("source_id")
  emailSent     Boolean              @default(false) @map("email_sent")
  emailSentAt   DateTime?            @map("email_sent_at")
  smsSent       Boolean              @default(false) @map("sms_sent")
  smsSentAt     DateTime?            @map("sms_sent_at")
  pushSent      Boolean              @default(false) @map("push_sent")
  pushSentAt    DateTime?            @map("push_sent_at")
  createdAt     DateTime             @default(now()) @map("created_at")
  updatedAt     DateTime             @updatedAt @map("updated_at")
  expiresAt     DateTime?            @map("expires_at")
  account       Account?             @relation("AccountNotifications", fields: [accountId], references: [id])
  case          Case?                @relation("CaseNotifications", fields: [caseId], references: [id])
  contact       Contact?             @relation("ContactNotifications", fields: [contactId], references: [id])
  lead          Lead?                @relation("LeadNotifications", fields: [leadId], references: [id])
  opportunity   Opportunity?         @relation("OpportunityNotifications", fields: [opportunityId], references: [id])
  user          User                 @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
  workOrder     WorkOrder?           @relation("WorkOrderNotifications", fields: [workOrderId], references: [id])

  @@index([userId, status])
  @@index([userId, createdAt])
  @@index([opportunityId])
  @@index([accountId])
  @@index([type])
  @@index([status])
  @@map("notifications")
}

model NotificationPreference {
  id                 String           @id @default(cuid())
  userId             String           @unique @map("user_id")
  emailEnabled       Boolean          @default(true) @map("email_enabled")
  smsEnabled         Boolean          @default(false) @map("sms_enabled")
  pushEnabled        Boolean          @default(true) @map("push_enabled")
  quietHoursEnabled  Boolean          @default(false) @map("quiet_hours_enabled")
  quietHoursStart    String?          @map("quiet_hours_start")
  quietHoursEnd      String?          @map("quiet_hours_end")
  quietHoursTimezone String?          @map("quiet_hours_timezone")
  typePreferences    Json             @default("{}") @map("type_preferences")
  digestEnabled      Boolean          @default(false) @map("digest_enabled")
  digestFrequency    DigestFrequency? @map("digest_frequency")
  digestTime         String?          @map("digest_time")
  lastDigestSentAt   DateTime?        @map("last_digest_sent_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  user               User             @relation("UserNotificationPreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

model NotificationTemplate {
  id                   String               @id @default(cuid())
  type                 NotificationType     @unique
  name                 String
  description          String?
  titleTemplate        String               @map("title_template")
  messageTemplate      String               @map("message_template")
  emailSubjectTemplate String?              @map("email_subject_template")
  emailBodyTemplate    String?              @map("email_body_template")
  smsTemplate          String?              @map("sms_template")
  defaultPriority      NotificationPriority @default(NORMAL) @map("default_priority")
  enabledByDefault     Boolean              @default(true) @map("enabled_by_default")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")

  @@map("notification_templates")
}

model ApprovalRequest {
  id               String            @id @default(cuid())
  type             ApprovalType
  status           ApprovalStatus    @default(PENDING)
  priority         Priority          @default(NORMAL)
  subject          String
  description      String?
  requestedValue   Decimal?          @map("requested_value") @db.Decimal(12, 2)
  originalValue    Decimal?          @map("original_value") @db.Decimal(12, 2)
  discountType     DiscountType?     @map("discount_type")
  discountPercent  Decimal?          @map("discount_percent") @db.Decimal(5, 2)
  discountAmount   Decimal?          @map("discount_amount") @db.Decimal(12, 2)
  currentStep      Int               @default(1) @map("current_step")
  totalSteps       Int               @default(1) @map("total_steps")
  decision         ApprovalDecision?
  decisionReason   String?           @map("decision_reason")
  decisionNotes    String?           @map("decision_notes")
  submittedAt      DateTime          @default(now()) @map("submitted_at")
  dueDate          DateTime?         @map("due_date")
  decidedAt        DateTime?         @map("decided_at")
  expiresAt        DateTime?         @map("expires_at")
  escalatedAt      DateTime?         @map("escalated_at")
  escalatedToId    String?           @map("escalated_to_id")
  escalationReason String?           @map("escalation_reason")
  requesterId      String            @map("requester_id")
  approverId       String?           @map("approver_id")
  decidedById      String?           @map("decided_by_id")
  opportunityId    String?           @map("opportunity_id")
  quoteId          String?           @map("quote_id")
  commissionId     String?           @map("commission_id")
  orderId          String?           @map("order_id")
  metadata         Json?
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  comments         ApprovalComment[]
  approver         User?             @relation("ApprovalApprover", fields: [approverId], references: [id])
  commission       Commission?       @relation(fields: [commissionId], references: [id])
  decidedBy        User?             @relation("ApprovalDecider", fields: [decidedById], references: [id])
  escalatedTo      User?             @relation("EscalatedApprovals", fields: [escalatedToId], references: [id])
  opportunity      Opportunity?      @relation(fields: [opportunityId], references: [id])
  order            Order?            @relation(fields: [orderId], references: [id])
  quote            Quote?            @relation(fields: [quoteId], references: [id])
  requester        User              @relation("ApprovalRequester", fields: [requesterId], references: [id])
  steps            ApprovalStep[]
  attentionItems   AttentionItem[]   @relation("ApprovalAttentionItems")

  @@index([status])
  @@index([type])
  @@index([requesterId])
  @@index([approverId])
  @@index([opportunityId])
  @@index([submittedAt])
  @@map("approval_requests")
}

model ApprovalStep {
  id                String            @id @default(cuid())
  stepNumber        Int               @map("step_number")
  name              String
  status            ApprovalStatus    @default(PENDING)
  approverId        String?           @map("approver_id")
  decision          ApprovalDecision?
  decisionReason    String?           @map("decision_reason")
  decidedAt         DateTime?         @map("decided_at")
  approvalRequestId String            @map("approval_request_id")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  approvalRequest   ApprovalRequest   @relation(fields: [approvalRequestId], references: [id], onDelete: Cascade)
  approver          User?             @relation(fields: [approverId], references: [id])

  @@unique([approvalRequestId, stepNumber])
  @@index([approvalRequestId])
  @@index([status])
  @@map("approval_steps")
}

model ApprovalComment {
  id                String          @id @default(cuid())
  content           String
  isInternal        Boolean         @default(false) @map("is_internal")
  authorId          String          @map("author_id")
  approvalRequestId String          @map("approval_request_id")
  createdAt         DateTime        @default(now()) @map("created_at")
  approvalRequest   ApprovalRequest @relation(fields: [approvalRequestId], references: [id], onDelete: Cascade)
  author            User            @relation(fields: [authorId], references: [id])

  @@index([approvalRequestId])
  @@map("approval_comments")
}

model ApprovalRule {
  id                  String       @id @default(cuid())
  name                String
  description         String?
  isActive            Boolean      @default(true) @map("is_active")
  type                ApprovalType
  minAmount           Decimal?     @map("min_amount") @db.Decimal(12, 2)
  maxAmount           Decimal?     @map("max_amount") @db.Decimal(12, 2)
  minDiscountPercent  Decimal?     @map("min_discount_percent") @db.Decimal(5, 2)
  approverRoles       String[]     @map("approver_roles")
  approverIds         String[]     @map("approver_ids")
  requireAllApprovers Boolean      @default(false) @map("require_all_approvers")
  escalationHours     Int?         @map("escalation_hours")
  escalateToId        String?      @map("escalate_to_id")
  priority            Int          @default(0)
  sortOrder           Int          @default(0) @map("sort_order")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")

  @@index([type])
  @@index([isActive])
  @@map("approval_rules")
}

model AttentionItem {
  id                  String              @id @default(cuid())
  title               String
  description         String?
  type                AttentionType
  category            AttentionCategory   @default(TASK)
  priority            Priority            @default(NORMAL)
  urgency             AttentionUrgency    @default(MEDIUM)
  status              AttentionStatus     @default(PENDING)
  sourceType          AttentionSourceType
  sourceId            String?             @map("source_id")
  sourceData          Json?               @map("source_data")
  dueDate             DateTime?           @map("due_date")
  daysOverdue         Int?                @map("days_overdue")
  amount              Decimal?            @db.Decimal(12, 2)
  assignedToId        String?             @map("assigned_to_id")
  teamId              String?             @map("team_id")
  opportunityId       String?             @map("opportunity_id")
  accountId           String?             @map("account_id")
  contactId           String?             @map("contact_id")
  leadId              String?             @map("lead_id")
  workOrderId         String?             @map("work_order_id")
  quoteId             String?             @map("quote_id")
  invoiceId           String?             @map("invoice_id")
  caseId              String?             @map("case_id")
  approvalRequestId   String?             @map("approval_request_id")
  conversationId      String?             @map("conversation_id")
  actionType          String?             @map("action_type")
  actionUrl           String?             @map("action_url")
  actionCompleted     Boolean             @default(false) @map("action_completed")
  actionCompletedAt   DateTime?           @map("action_completed_at")
  actionCompletedById String?             @map("action_completed_by_id")
  dismissedAt         DateTime?           @map("dismissed_at")
  dismissedById       String?             @map("dismissed_by_id")
  dismissReason       String?             @map("dismiss_reason")
  snoozedUntil        DateTime?           @map("snoozed_until")
  aiSummary           String?             @map("ai_summary")
  aiSuggestedAction   String?             @map("ai_suggested_action")
  aiConfidence        Float?              @map("ai_confidence")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  expiresAt           DateTime?           @map("expires_at")
  account             Account?            @relation("AccountAttentionItems", fields: [accountId], references: [id])
  approvalRequest     ApprovalRequest?    @relation("ApprovalAttentionItems", fields: [approvalRequestId], references: [id])
  assignedTo          User?               @relation("AssignedAttentionItems", fields: [assignedToId], references: [id])
  case                Case?               @relation("CaseAttentionItems", fields: [caseId], references: [id])
  contact             Contact?            @relation("ContactAttentionItems", fields: [contactId], references: [id])
  dismissedBy         User?               @relation("DismissedAttentionItems", fields: [dismissedById], references: [id])
  invoice             Invoice?            @relation("InvoiceAttentionItems", fields: [invoiceId], references: [id])
  lead                Lead?               @relation("LeadAttentionItems", fields: [leadId], references: [id])
  opportunity         Opportunity?        @relation("OpportunityAttentionItems", fields: [opportunityId], references: [id])
  quote               Quote?              @relation("QuoteAttentionItems", fields: [quoteId], references: [id])
  workOrder           WorkOrder?          @relation("WorkOrderAttentionItems", fields: [workOrderId], references: [id])

  @@index([assignedToId])
  @@index([status])
  @@index([priority])
  @@index([urgency])
  @@index([type])
  @@index([category])
  @@index([sourceType])
  @@index([opportunityId])
  @@index([accountId])
  @@index([dueDate])
  @@index([createdAt])
  @@map("attention_items")
}

model CallLog {
  id                     String               @id @default(cuid())
  direction              CallDirection        @default(OUTBOUND)
  callType               CallType             @default(VOICE)
  phoneNumber            String               @map("phone_number")
  formattedPhone         String?              @map("formatted_phone")
  startTime              DateTime             @map("start_time")
  endTime                DateTime?            @map("end_time")
  duration               Int?
  ringTime               Int?                 @map("ring_time")
  holdTime               Int?                 @map("hold_time")
  talkTime               Int?                 @map("talk_time")
  disposition            String?
  dispositionName        String?              @map("disposition_name")
  dispositionNotes       String?              @map("disposition_notes")
  recordingUrl           String?              @map("recording_url")
  recordingDuration      Int?                 @map("recording_duration")
  transcription          String?
  transcriptionStatus    TranscriptionStatus? @map("transcription_status")
  sentiment              CallSentiment?
  summary                String?
  keyPoints              Json?                @map("key_points")
  nextActions            Json?                @map("next_actions")
  aiAnalyzedAt           DateTime?            @map("ai_analyzed_at")
  opportunityId          String?              @map("opportunity_id")
  accountId              String?              @map("account_id")
  contactId              String?              @map("contact_id")
  leadId                 String?              @map("lead_id")
  userId                 String?              @map("user_id")
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")
  extensionId            String?              @map("extension_id")
  extensionName          String?              @map("extension_name")
  recordingId            String?              @map("recording_id")
  ringCentralCallId      String?              @unique @map("ringcentral_call_id")
  ringCentralSessionId   String?              @map("ringcentral_session_id")
  ringCentralTelephonyId String?              @map("ringcentral_telephony_id")
  account                Account?             @relation(fields: [accountId], references: [id])
  contact                Contact?             @relation(fields: [contactId], references: [id])
  lead                   Lead?                @relation(fields: [leadId], references: [id])
  opportunity            Opportunity?         @relation(fields: [opportunityId], references: [id])
  user                   User?                @relation(fields: [userId], references: [id])

  @@index([ringCentralCallId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([contactId])
  @@index([leadId])
  @@index([userId])
  @@index([startTime])
  @@index([disposition])
  @@map("call_logs")
}

model MeasurementReport {
  id                   String              @id @default(cuid())
  externalId           String?             @unique @map("external_id")
  provider             MeasurementProvider @default(EAGLEVIEW)
  orderNumber          String?             @map("order_number")
  orderStatus          String?             @map("order_status")
  reportType           ReportType          @default(PREMIUM)
  reportUrl            String?             @map("report_url")
  reportPdfUrl         String?             @map("report_pdf_url")
  reportXmlUrl         String?             @map("report_xml_url")
  reportJsonUrl        String?             @map("report_json_url")
  propertyAddress      String              @map("property_address")
  propertyCity         String?             @map("property_city")
  propertyState        String?             @map("property_state")
  propertyZip          String?             @map("property_zip")
  latitude             Float?
  longitude            Float?
  totalRoofArea        Float?              @map("total_roof_area")
  totalRoofSquares     Float?              @map("total_roof_squares")
  predominantPitch     String?             @map("predominant_pitch")
  pitches              Json?
  facets               Int?
  ridgeLength          Float?              @map("ridge_length")
  hipLength            Float?              @map("hip_length")
  valleyLength         Float?              @map("valley_length")
  rakeLength           Float?              @map("rake_length")
  eaveLength           Float?              @map("eave_length")
  flashingLength       Float?              @map("flashing_length")
  stepFlashingLength   Float?              @map("step_flashing_length")
  dripEdgeLength       Float?              @map("drip_edge_length")
  structureType        String?             @map("structure_type")
  stories              Int?
  buildingHeight       Float?              @map("building_height")
  roofComplexity       RoofComplexity?     @map("roof_complexity")
  totalSidingArea      Float?              @map("total_siding_area")
  sidingWalls          Json?               @map("siding_walls")
  totalGutterLength    Float?              @map("total_gutter_length")
  downspoutCount       Int?                @map("downspout_count")
  windowCount          Int?                @map("window_count")
  doorCount            Int?                @map("door_count")
  skylightCount        Int?                @map("skylight_count")
  suggestedWasteFactor Float?              @map("suggested_waste_factor")
  rawData              Json?               @map("raw_data")
  opportunityId        String              @map("opportunity_id")
  accountId            String?             @map("account_id")
  orderedById          String?             @map("ordered_by_id")
  orderedAt            DateTime?           @map("ordered_at")
  deliveredAt          DateTime?           @map("delivered_at")
  createdAt            DateTime            @default(now()) @map("created_at")
  updatedAt            DateTime            @updatedAt @map("updated_at")
  captureLink          String?             @map("capture_link")
  designViewerUrl      String?             @map("design_viewer_url")
  modelViewerUrl       String?             @map("model_viewer_url")
  notes                String?
  account              Account?            @relation(fields: [accountId], references: [id])
  opportunity          Opportunity         @relation(fields: [opportunityId], references: [id])
  orderedBy            User?               @relation(fields: [orderedById], references: [id])

  @@index([externalId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([provider])
  @@index([orderStatus])
  @@map("measurement_reports")
}

model IntegrationCredential {
  id             String    @id @default(cuid())
  provider       String    @unique
  accessToken    String?   @map("access_token")
  refreshToken   String?   @map("refresh_token")
  tokenExpiresAt DateTime? @map("token_expires_at")
  apiKey         String?   @map("api_key")
  clientId       String?   @map("client_id")
  clientSecret   String?   @map("client_secret")
  webhookSecret  String?   @map("webhook_secret")
  webhookUrl     String?   @map("webhook_url")
  isActive       Boolean   @default(true) @map("is_active")
  lastUsedAt     DateTime? @map("last_used_at")
  metadata       Json?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  @@index([provider])
  @@index([isActive])
  @@map("integration_credentials")
}

model ScheduleOptimization {
  id                      String              @id @default(cuid())
  runDate                 DateTime            @map("run_date")
  runType                 OptimizationRunType @map("run_type")
  status                  OptimizationStatus  @default(PENDING)
  territoryId             String?             @map("territory_id")
  startDate               DateTime            @map("start_date")
  endDate                 DateTime            @map("end_date")
  resourceIds             String[]            @map("resource_ids")
  appointmentsConsidered  Int?                @map("appointments_considered")
  resourcesConsidered     Int?                @map("resources_considered")
  constraints             Json?
  appointmentsOptimized   Int?                @map("appointments_optimized")
  appointmentsRescheduled Int?                @map("appointments_rescheduled")
  travelTimeReduced       Int?                @map("travel_time_reduced")
  utilizationImproved     Float?              @map("utilization_improved")
  changes                 Json?
  suggestedChanges        Json?               @map("suggested_changes")
  executionTimeMs         Int?                @map("execution_time_ms")
  algorithmVersion        String?             @map("algorithm_version")
  autoApproved            Boolean             @default(false) @map("auto_approved")
  approvedById            String?             @map("approved_by_id")
  approvedAt              DateTime?           @map("approved_at")
  createdAt               DateTime            @default(now()) @map("created_at")
  updatedAt               DateTime            @updatedAt @map("updated_at")
  completedAt             DateTime?           @map("completed_at")
  approvedBy              User?               @relation(fields: [approvedById], references: [id])
  territory               ServiceTerritory?   @relation(fields: [territoryId], references: [id])

  @@index([territoryId])
  @@index([runDate])
  @@index([status])
  @@map("schedule_optimizations")
}

model ResourceCapacity {
  id                 String          @id @default(cuid())
  serviceResourceId  String          @map("service_resource_id")
  date               DateTime        @db.Date
  dayOfWeek          Int             @map("day_of_week")
  availableFrom      DateTime        @map("available_from")
  availableTo        DateTime        @map("available_to")
  breakStart         DateTime?       @map("break_start")
  breakEnd           DateTime?       @map("break_end")
  maxAppointments    Int?            @map("max_appointments")
  maxTravelMinutes   Int?            @map("max_travel_minutes")
  currentUtilization Float?          @map("current_utilization")
  preferredZipCodes  String[]        @map("preferred_zip_codes")
  maxTravelRadius    Float?          @map("max_travel_radius")
  isOverride         Boolean         @default(false) @map("is_override")
  overrideReason     String?         @map("override_reason")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  serviceResource    ServiceResource @relation(fields: [serviceResourceId], references: [id])

  @@unique([serviceResourceId, date])
  @@index([serviceResourceId])
  @@index([date])
  @@map("resource_capacities")
}

model MobileSession {
  id           String     @id @default(cuid())
  userId       String     @map("user_id")
  deviceId     String     @map("device_id")
  deviceType   DeviceType @map("device_type")
  deviceModel  String?    @map("device_model")
  osVersion    String?    @map("os_version")
  appVersion   String     @map("app_version")
  sessionToken String     @unique @map("session_token")
  pushToken    String?    @map("push_token")
  lastActiveAt DateTime   @map("last_active_at")
  lastLocation Json?      @map("last_location")
  isActive     Boolean    @default(true) @map("is_active")
  loggedOutAt  DateTime?  @map("logged_out_at")
  logoutReason String?    @map("logout_reason")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  user         User       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([deviceId])
  @@index([sessionToken])
  @@index([isActive])
  @@map("mobile_sessions")
}

model MobileActivity {
  id            String             @id @default(cuid())
  userId        String             @map("user_id")
  sessionId     String?            @map("session_id")
  activityType  MobileActivityType @map("activity_type")
  screenName    String?            @map("screen_name")
  action        String?
  opportunityId String?            @map("opportunity_id")
  accountId     String?            @map("account_id")
  entityType    String?            @map("entity_type")
  entityId      String?            @map("entity_id")
  latitude      Float?
  longitude     Float?
  accuracy      Float?
  metadata      Json?
  duration      Int?
  createdAt     DateTime           @default(now()) @map("created_at")
  account       Account?           @relation(fields: [accountId], references: [id])
  opportunity   Opportunity?       @relation(fields: [opportunityId], references: [id])
  user          User               @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([opportunityId])
  @@index([activityType])
  @@index([createdAt])
  @@map("mobile_activities")
}

model Activity {
  id            String       @id @default(cuid())
  type          ActivityType
  subType       String?      @map("sub_type")
  subject       String?
  description   String?
  body          String?
  bodyHtml      String?      @map("body_html")
  status        String?
  sourceId      String?      @map("source_id")
  sourceType    String?      @map("source_type")
  accountId     String?      @map("account_id")
  contactId     String?      @map("contact_id")
  opportunityId String?      @map("opportunity_id")
  leadId        String?      @map("lead_id")
  userId        String?      @map("user_id")
  externalPhone String?      @map("external_phone")
  externalEmail String?      @map("external_email")
  externalName  String?      @map("external_name")
  metadata      Json?
  occurredAt    DateTime     @default(now()) @map("occurred_at")
  createdAt     DateTime     @default(now()) @map("created_at")
  account       Account?     @relation("AccountActivities", fields: [accountId], references: [id])
  contact       Contact?     @relation("ContactActivities", fields: [contactId], references: [id])
  lead          Lead?        @relation("LeadActivities", fields: [leadId], references: [id])
  opportunity   Opportunity? @relation("OpportunityActivities", fields: [opportunityId], references: [id])
  user          User?        @relation("UserActivities", fields: [userId], references: [id])

  @@index([accountId])
  @@index([contactId])
  @@index([opportunityId])
  @@index([leadId])
  @@index([userId])
  @@index([type])
  @@index([occurredAt])
  @@map("activities")
}

model CallList {
  id                 String                @id @default(cuid())
  name               String
  description        String?
  listType           CallListType          @default(DYNAMIC) @map("list_type")
  targetObject       String?               @map("target_object")
  filterCriteria     Json?                 @map("filter_criteria")
  sort_criteria      Json?
  cadence_hours      Int?
  cadence_type       CadenceType           @default(PREVIEW)
  max_attempts       Int                   @default(6)
  cooldown_days      Int                   @default(7)
  active_hours_start String?
  active_hours_end   String?
  active_days        String[]
  timezone           String                @default("America/New_York")
  states             String[]
  priority           Int                   @default(50)
  isActive           Boolean               @default(true) @map("is_active")
  totalItems         Int                   @default(0) @map("total_items")
  pendingItems       Int                   @default(0) @map("pending_items")
  completed_today    Int                   @default(0)
  lastRefreshedAt    DateTime?             @map("last_refreshed_at")
  assigned_team_id   String?
  assignedUserId     String?               @map("assigned_user_id")
  createdById        String?               @map("created_by_id")
  createdAt          DateTime              @default(now()) @map("created_at")
  updatedAt          DateTime              @updatedAt @map("updated_at")
  dispositions       CallListDisposition[]
  items              CallListItem[]
  assignedUser       User?                 @relation("CallListAssignedUser", fields: [assignedUserId], references: [id])
  createdBy          User?                 @relation("CallListCreatedBy", fields: [createdById], references: [id])

  @@index([listType])
  @@index([isActive])
  @@index([priority])
  @@map("call_lists")
}

model CallListItem {
  id                  String             @id @default(cuid())
  callListId          String             @map("call_list_id")
  leadId              String?            @map("lead_id")
  opportunityId       String?            @map("opportunity_id")
  contactId           String?            @map("contact_id")
  accountId           String?            @map("account_id")
  phoneNumber         String             @map("phone_number")
  formattedPhone      String?            @map("formatted_phone")
  displayName         String             @map("display_name")
  displayAddress      String?            @map("display_address")
  displayStatus       String?            @map("display_status")
  attempt_count       Int                @default(0)
  last_attempt_at     DateTime?
  last_attempt_result String?
  next_attempt_at     DateTime?
  status              CallListItemStatus @default(PENDING)
  disposition         String?
  disposition_at      DateTime?
  priority            Int                @default(50)
  scheduled_for       DateTime?
  assignedToId        String?            @map("assigned_to_id")
  addedReason         String?            @map("added_reason")
  source_list_id      String?
  added_at            DateTime           @default(now())
  completedAt         DateTime?          @map("completed_at")
  expires_at          DateTime?
  assignedTo          User?              @relation("CallListItemAssignedTo", fields: [assignedToId], references: [id])
  callList            CallList           @relation(fields: [callListId], references: [id], onDelete: Cascade)

  @@unique([callListId, contactId])
  @@unique([callListId, leadId])
  @@unique([callListId, opportunityId])
  @@index([status])
  @@index([assignedToId])
  @@index([next_attempt_at])
  @@index([scheduled_for])
  @@map("call_list_items")
}

model CallListDisposition {
  id                 String              @id @default(cuid())
  callListId         String?             @map("call_list_id")
  code               String
  name               String
  description        String?
  category           DispositionCategory @default(OTHER)
  remove_from_list   Boolean             @default(false)
  move_to_list_id    String?
  update_lead_status String?
  update_opp_stage   String?
  schedule_callback  Boolean             @default(false)
  add_to_dnc         Boolean             @default(false)
  cooldown_days      Int?
  color              String?
  icon               String?
  sortOrder          Int                 @default(0) @map("sort_order")
  isActive           Boolean             @default(true) @map("is_active")
  require_note       Boolean             @default(false)
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  callList           CallList?           @relation(fields: [callListId], references: [id], onDelete: Cascade)

  @@unique([callListId, code])
  @@index([category])
  @@index([isActive])
  @@map("call_list_dispositions")
}

model CallSession {
  id                 String      @id @default(cuid())
  userId             String      @map("user_id")
  startedAt          DateTime    @default(now()) @map("started_at")
  endedAt            DateTime?   @map("ended_at")
  pausedAt           DateTime?   @map("paused_at")
  total_pause_ms     Int         @default(0)
  totalCalls         Int         @default(0) @map("total_calls")
  connectedCalls     Int         @default(0) @map("connected_calls")
  totalTalkTimeMs    Int         @default(0) @map("total_talk_time_ms")
  total_wrap_time_ms Int         @default(0)
  currentListId      String?     @map("current_list_id")
  dialer_mode        CadenceType @default(PREVIEW)
  device_info        String?
  ip_address         String?
  termination_reason String?
  user               User        @relation("UserCallSessions", fields: [userId], references: [id])

  @@index([userId])
  @@index([startedAt])
  @@map("call_sessions")
}

model automation_configs {
  id             String   @id
  type           String   @unique
  name           String
  enabled        Boolean  @default(false)
  sms_enabled    Boolean  @default(true)
  email_enabled  Boolean  @default(true)
  sms_template   String?
  email_subject  String?
  email_template String?
  trigger_delay  Int      @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime
}

model call_campaigns {
  id                 String             @id
  name               String
  description        String?
  status             CallCampaignStatus @default(DRAFT)
  start_date         DateTime
  end_date           DateTime?
  list_ids           String[]
  target_calls       Int?
  target_contacts    Int?
  target_conversions Int?
  total_calls        Int                @default(0)
  total_contacts     Int                @default(0)
  total_conversions  Int                @default(0)
  team_ids           String[]
  manager_ids        String[]
  created_by_id      String?
  created_at         DateTime           @default(now())
  updated_at         DateTime
  users              User?              @relation(fields: [created_by_id], references: [id])

  @@index([start_date])
  @@index([status])
}

model code_documentation {
  id          String   @id
  file_path   String   @unique
  file_hash   String
  components  String[] @default([])
  functions   String[] @default([])
  routes      String[] @default([])
  jsdoc_count Int      @default(0)
  documented  Boolean  @default(false)
  article_ids String[] @default([])
  analyzed_at DateTime @default(now())
  updated_at  DateTime

  @@index([documented])
}

model companycam_crew_access {
  id                    String    @id
  companycam_project_id String
  companycam_user_id    String
  user_email            String
  user_name             String
  opportunity_id        String?
  granted_at            DateTime  @default(now())
  revoked_at            DateTime?
  created_at            DateTime  @default(now())
  updated_at            DateTime

  @@unique([companycam_project_id, user_email])
  @@index([companycam_project_id])
  @@index([opportunity_id])
  @@index([user_email])
}

model custom_fields {
  id            String          @id
  object_name   String
  name          String
  api_name      String
  type          CustomFieldType
  description   String?
  required      Boolean         @default(false)
  unique        Boolean         @default(false)
  default_value String?
  help_text     String?
  config        Json?
  sort_order    Int             @default(0)
  is_active     Boolean         @default(true)
  created_by_id String?
  created_at    DateTime        @default(now())
  updated_at    DateTime
  users         User?           @relation(fields: [created_by_id], references: [id])

  @@unique([object_name, api_name])
  @@index([is_active])
  @@index([object_name])
}

model help_article_feedback {
  id         String   @id
  article_id String
  user_id    String?
  helpful    Boolean
  comment    String?
  created_at DateTime @default(now())

  @@index([article_id])
}

model help_articles {
  id                                       String    @id
  title                                    String
  category                                 String
  summary                                  String
  content                                  String
  published                                Boolean   @default(false)
  featured                                 Boolean   @default(false)
  ai_generated                             Boolean   @default(false)
  source_feature                           String?
  source_files                             String[]  @default([])
  last_ai_update                           DateTime?
  views                                    Int       @default(0)
  helpful                                  Int       @default(50)
  created_by_id                            String?
  updated_by_id                            String?
  created_at                               DateTime  @default(now())
  updated_at                               DateTime
  users_help_articles_created_by_idTousers User?     @relation("help_articles_created_by_idTousers", fields: [created_by_id], references: [id])
  users_help_articles_updated_by_idTousers User?     @relation("help_articles_updated_by_idTousers", fields: [updated_by_id], references: [id])

  @@index([category])
  @@index([source_feature])
  @@index([title, summary])
}

model job_id_sequences {
  id          String   @id
  year        Int      @unique
  last_number Int      @default(999)
  created_at  DateTime @default(now())
  updated_at  DateTime
}

model page_layouts {
  id            String   @id
  object_name   String
  name          String
  description   String?
  is_default    Boolean  @default(false)
  config        Json
  is_active     Boolean  @default(true)
  created_by_id String?
  created_at    DateTime @default(now())
  updated_at    DateTime
  users         User?    @relation(fields: [created_by_id], references: [id])

  @@index([is_default])
  @@index([object_name])
}

model push_tokens {
  id         String   @id
  user_id    String
  token      String
  platform   String   @default("unknown")
  active     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, token])
  @@index([active])
  @@index([user_id])
}

model validation_rules {
  id             String   @id
  object_name    String
  name           String
  description    String?
  error_message  String
  error_location String?
  formula        String
  is_active      Boolean  @default(true)
  created_by_id  String?
  created_at     DateTime @default(now())
  updated_at     DateTime
  users          User?    @relation(fields: [created_by_id], references: [id])

  @@index([is_active])
  @@index([object_name])
}

model work_order_line_items {
  id                  String            @id
  salesforce_id       String?           @unique
  line_item_number    String            @unique
  description         String?
  status              WorkOrderStatus   @default(NEW)
  start_date          DateTime?
  end_date            DateTime?
  duration            Int?
  quantity            Float?            @default(1)
  unit_price          Float?
  total_price         Float?
  work_order_id       String
  work_type_id        String?
  opportunity_id      String?
  territory_id        String?
  created_at          DateTime          @default(now())
  updated_at          DateTime
  opportunities       Opportunity?      @relation(fields: [opportunity_id], references: [id])
  service_territories ServiceTerritory? @relation(fields: [territory_id], references: [id])
  work_orders         WorkOrder         @relation(fields: [work_order_id], references: [id])
  work_types          WorkType?         @relation(fields: [work_type_id], references: [id])

  @@index([opportunity_id])
  @@index([status])
  @@index([work_order_id])
  @@index([work_type_id])
}

enum ConversationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum AccountType {
  RESIDENTIAL
  COMMERCIAL
  INSURANCE
}

enum AccountStatus {
  NEW
  ACTIVE
  ONBOARDING
  IN_PRODUCTION
  COMPLETED
  INACTIVE
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  UNQUALIFIED
  NURTURING
  CONVERTED
}

enum LeadRating {
  HOT
  WARM
  COLD
}

enum OpportunityStage {
  LEAD_UNASSIGNED
  LEAD_ASSIGNED
  SCHEDULED
  INSPECTED
  CLAIM_FILED
  APPROVED
  CONTRACT_SIGNED
  IN_PRODUCTION
  COMPLETED
  CLOSED_WON
  CLOSED_LOST
  ADJUSTER_MEETING_COMPLETE
}

enum OpportunityType {
  INSURANCE
  RETAIL
  COMMERCIAL
}

enum WorkOrderStatus {
  DRAFT
  NEW
  READY_TO_SCHEDULE
  SCHEDULED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
  CANCELED
}

enum AppointmentStatus {
  NONE
  SCHEDULED
  DISPATCHED
  IN_PROGRESS
  COMPLETED
  CANNOT_COMPLETE
  CANCELED
}

enum ResourceType {
  TECHNICIAN
  CREW
  DISPATCHER
  AGENT
}

enum AbsenceType {
  VACATION
  SICK
  TRAINING
  UNAVAILABLE
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  EXPERT
}

enum QuoteStatus {
  DRAFT
  NEEDS_REVIEW
  IN_REVIEW
  APPROVED
  REJECTED
  ACCEPTED
  EXPIRED
}

enum OrderStatus {
  DRAFT
  ACTIVATED
  SUBMITTED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELED
}

enum OrderType {
  STANDARD
  CHANGE_ORDER
  SUPPLEMENT
}

enum MaterialStatus {
  WAITING
  ORDERED
  DELIVERED
  CANCELLED
}

enum DeliveryType {
  DELIVERY
  PICKUP
  ROOF_LOAD
  GROUND_DROP
}

enum DeliveryTimeWindow {
  AM
  PM
  ALL_DAY
  FIRST_LOAD
}

enum InvoiceStatus {
  DRAFT
  PENDING
  SENT
  PARTIAL
  PAID
  OVERDUE
  VOID
}

enum PaymentMethod {
  CHECK
  CREDIT_CARD
  ACH
  WIRE
  CASH
  INSURANCE_CHECK
  FINANCING
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SETTLED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum SyncStatus {
  PENDING
  SYNCED
  FAILED
  SKIPPED
}

enum PaymentLinkStatus {
  ACTIVE
  INACTIVE
  EXPIRED
  COMPLETED
}

enum PaymentFrequency {
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  CUSTOM
}

enum ScheduleStatus {
  PENDING
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum ContractStatus {
  DRAFT
  ACTIVATED
  COMPLETED
  TERMINATED
}

enum CommissionType {
  PRE_COMMISSION
  BACK_END
  SALES_OP
  SUPPLEMENT_OVERRIDE
  PM_COMMISSION
  MANAGER_OVERRIDE
  REGIONAL_MANAGER_OVERRIDE
  DIRECTOR_OVERRIDE
  EXECUTIVE_OVERRIDE
  SALES_FLIP
  PAYROLL_ADJUSTMENT
  COMPANY_LEAD
  SELF_GEN
}

enum CommissionStatus {
  NEW
  REQUESTED
  APPROVED
  HOLD
  PAID
  DENIED
}

enum MessageDirection {
  INBOUND
  OUTBOUND
}

enum MessageChannel {
  SMS
  EMAIL
  CHAT
}

enum MessageStatus {
  QUEUED
  SENDING
  SENT
  DELIVERED
  READ
  FAILED
}

enum ConversationStatus {
  OPEN
  PENDING
  RESOLVED
  CLOSED
}

enum CaseStatus {
  NEW
  WORKING
  ESCALATED
  CLOSED
}

enum TaskStatus {
  NOT_STARTED
  IN_PROGRESS
  WAITING
  COMPLETED
  DEFERRED
}

enum Priority {
  LOW
  NORMAL
  HIGH
  CRITICAL
}

enum EventStatus {
  SCHEDULED
  CONFIRMED
  TENTATIVE
  IN_PROGRESS
  COMPLETED
  CANCELED
  NO_SHOW
}

enum EventShowAs {
  FREE
  BUSY
  TENTATIVE
  OUT_OF_OFFICE
}

enum EmailDirection {
  INBOUND
  OUTBOUND
}

enum EmailStatus {
  DRAFT
  SCHEDULED
  QUEUED
  SENDING
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  COMPLAINED
  UNSUBSCRIBED
  FAILED
}

enum CampaignType {
  SMS
  EMAIL
  VOICE
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  PAUSED
  CANCELED
}

enum SendSchedule {
  IMMEDIATE
  SCHEDULED
  RECURRING
}

enum ScheduledMessageStatus {
  PENDING
  SENT
  FAILED
  CANCELED
}

enum AgreementStatus {
  DRAFT
  SENT
  VIEWED
  SIGNED
  DECLINED
  EXPIRED
  VOIDED
  PARTIALLY_SIGNED
  COMPLETED
}

enum SignerRole {
  CUSTOMER
  SALES_REP
  PM
  WITNESS
  CO_SIGNER
}

enum SignatureStatus {
  PENDING
  SENT
  VIEWED
  SIGNED
  DECLINED
}

enum FileCategory {
  PHOTO
  DOCUMENT
  CONTRACT
  INVOICE
  PERMIT
  INSPECTION
  OTHER
}

enum TriggerEvent {
  CREATE
  UPDATE
  DELETE
  FIELD_CHANGE
  SCHEDULED
}

enum WorkflowActionType {
  UPDATE_FIELD
  SEND_SMS
  SEND_EMAIL
  CREATE_RECORD
  CREATE_TASK
  CALL_WEBHOOK
  DELAY
  CREATE_COMMISSION
  SCHEDULE_APPOINTMENT
  SEND_AGREEMENT
}

enum WorkflowExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  VIEW
}

enum PermissionAction {
  CREATE
  READ
  UPDATE
  DELETE
  EXPORT
  APPROVE
  ASSIGN
}

enum CommissionCalcType {
  PERCENTAGE
  FLAT
  TIERED
}

enum CommissionRuleType {
  PERCENTAGE
  FLAT
  BONUS
}

enum CommissionTrigger {
  CONTRACT_CREATED
  ONBOARDING_COMPLETE
  DOWNPAYMENT_RECEIVED
  BALANCE_PAID
  JOB_COMPLETED
  SUPPLEMENT_APPROVED
}

enum ReportCategory {
  SALES
  FINANCIAL
  MARKETING
  ACTIVITY
  OPERATIONS
  CUSTOM
}

enum ChartType {
  BAR
  LINE
  AREA
  PIE
  DONUT
  TABLE
  KPI
}

enum WidgetType {
  KPI_CARD
  BAR_CHART
  LINE_CHART
  AREA_CHART
  PIE_CHART
  DONUT_CHART
  TABLE
  STAT_LIST
}

enum DashboardLayout {
  GRID
  FREEFORM
}

enum AssignmentType {
  SPECIFIC_USER
  ROUND_ROBIN
  TEAM
  QUEUE
  TERRITORY
  MANUAL
}

enum TeamRole {
  LEADER
  MEMBER
}

enum NotificationType {
  STAGE_CHANGE
  ASSIGNMENT
  OPPORTUNITY_WON
  OPPORTUNITY_LOST
  OPPORTUNITY_CREATED
  WORK_ORDER_CREATED
  WORK_ORDER_STATUS_CHANGE
  WORK_ORDER_COMPLETED
  APPOINTMENT_SCHEDULED
  APPOINTMENT_REMINDER
  APPOINTMENT_COMPLETED
  APPOINTMENT_CANCELLED
  CASE_CREATED
  CASE_ESCALATED
  CASE_RESOLVED
  CASE_COMMENT
  TASK_ASSIGNED
  TASK_DUE_SOON
  TASK_OVERDUE
  TASK_COMPLETED
  QUOTE_CREATED
  QUOTE_APPROVED
  QUOTE_REJECTED
  ORDER_CREATED
  ORDER_STATUS_CHANGE
  COMMISSION_CREATED
  COMMISSION_APPROVED
  COMMISSION_PAID
  EMAIL_RECEIVED
  EMAIL_OPENED
  EMAIL_BOUNCED
  APPROVAL_REQUESTED
  APPROVAL_APPROVED
  APPROVAL_REJECTED
  MENTION
  COMMENT
  DOCUMENT_UPLOADED
  SYSTEM_ALERT
}

enum NotificationStatus {
  UNREAD
  READ
  ARCHIVED
  DELETED
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum DigestFrequency {
  DAILY
  WEEKLY
}

enum ApprovalType {
  DISCOUNT
  COMMISSION
  PRICE_OVERRIDE
  CREDIT
  SUPPLEMENT
  CHANGE_ORDER
  EXCEPTION
}

enum ApprovalStatus {
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  EXPIRED
  CANCELLED
  ESCALATED
}

enum ApprovalDecision {
  APPROVE
  REJECT
  REQUEST_CHANGES
  DELEGATE
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  CUSTOM
}

enum AttentionType {
  FOLLOW_UP
  CALLBACK_REQUEST
  OVERDUE_TASK
  OVERDUE_INVOICE
  APPROVAL_NEEDED
  SCHEDULE_CONFLICT
  UNREAD_MESSAGE
  STALLED_DEAL
  MISSING_INFO
  CUSTOMER_COMPLAINT
  INSPECTION_DUE
  SUPPLEMENT_PENDING
  PAYMENT_ISSUE
  DOCUMENT_NEEDED
  WORK_ORDER_ISSUE
  CASE_ESCALATION
  LEAD_AGING
  QUOTE_EXPIRING
  CONTRACT_ISSUE
  GENERAL
}

enum AttentionCategory {
  TASK
  COMMUNICATION
  FINANCIAL
  APPROVAL
  SCHEDULING
  DOCUMENT
  ESCALATION
}

enum AttentionUrgency {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum AttentionStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DISMISSED
  SNOOZED
  EXPIRED
}

enum AttentionSourceType {
  OPPORTUNITY
  ACCOUNT
  CONTACT
  LEAD
  WORK_ORDER
  SERVICE_APPOINTMENT
  QUOTE
  INVOICE
  PAYMENT
  CASE
  CONVERSATION
  APPROVAL
  TASK
  CALENDAR
  WORKFLOW
  MANUAL
  AI
}

enum CallDirection {
  INBOUND
  OUTBOUND
  INTERNAL
  TRANSFER
}

enum CallType {
  VOICE
  VOICEMAIL
  CALLBACK
  PREVIEW
  PREDICTIVE
  MANUAL
}

enum TranscriptionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  NOT_AVAILABLE
}

enum CallSentiment {
  VERY_POSITIVE
  POSITIVE
  NEUTRAL
  NEGATIVE
  VERY_NEGATIVE
}

enum MeasurementProvider {
  EAGLEVIEW
  GAF_QUICKMEASURE
  ROOFSNAP
  HOVER
  MANUAL
}

enum ReportType {
  BASIC
  PREMIUM
  ULTRA_PREMIUM
  COMMERCIAL
  WALLS_ONLY
  ROOF_AND_WALLS
  RESIDENTIAL_SINGLE
  RESIDENTIAL_MULTI
  EXTERIOR
  EXTERIOR_PLUS
  FULL_PROPERTY
}

enum RoofComplexity {
  SIMPLE
  MODERATE
  COMPLEX
  VERY_COMPLEX
}

enum OptimizationRunType {
  DAILY_AUTO
  WEEKLY_AUTO
  MANUAL
  EMERGENCY
  RESOURCE_CHANGE
  NEW_APPOINTMENTS
}

enum OptimizationStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  PARTIALLY_APPLIED
  AWAITING_APPROVAL
  CANCELLED
}

enum DeviceType {
  IOS
  ANDROID
  TABLET_IOS
  TABLET_ANDROID
  WEB_MOBILE
}

enum MobileActivityType {
  APP_OPEN
  APP_CLOSE
  APP_BACKGROUND
  SCREEN_VIEW
  OPPORTUNITY_VIEW
  OPPORTUNITY_UPDATE
  PHOTO_CAPTURE
  PHOTO_UPLOAD
  SIGNATURE_CAPTURE
  FORM_SUBMIT
  CALL_INITIATED
  CALL_LOGGED
  CHECKIN
  CHECKOUT
  GPS_UPDATE
  PUSH_RECEIVED
  PUSH_OPENED
  OFFLINE_SYNC
  ERROR
}

enum ActivityType {
  SMS_SENT
  SMS_RECEIVED
  EMAIL_SENT
  EMAIL_RECEIVED
  CALL_OUTBOUND
  CALL_INBOUND
  CALL_MISSED
  VOICEMAIL
  TASK_CREATED
  TASK_COMPLETED
  EVENT_CREATED
  EVENT_COMPLETED
  RECORD_CREATED
  RECORD_UPDATED
  STATUS_CHANGED
  STAGE_CHANGED
  OWNER_CHANGED
  DOCUMENT_UPLOADED
  DOCUMENT_SIGNED
  QUOTE_SENT
  CONTRACT_SIGNED
  NOTE_ADDED
  COMMENT_ADDED
  SYSTEM_NOTIFICATION
  WORKFLOW_TRIGGERED
}

enum CallListType {
  DYNAMIC
  STATIC
  IMPORT
  CALLBACK
}

enum CadenceType {
  PREVIEW
  PROGRESSIVE
  PREDICTIVE
  MANUAL
}

enum CallCampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CallListItemStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  RESCHEDULED
  SKIPPED
  EXPIRED
  REMOVED
}

enum CustomFieldType {
  TEXT
  TEXTAREA
  NUMBER
  CURRENCY
  DATE
  DATETIME
  CHECKBOX
  PICKLIST
  MULTIPICKLIST
  LOOKUP
  EMAIL
  PHONE
  URL
  PERCENT
}

enum DispositionCategory {
  POSITIVE
  NEGATIVE
  CALLBACK
  NO_CONTACT
  QUALIFIED
  DISQUALIFIED
  OTHER
}

enum InvoiceWorkflowStatus {
  NOT_READY
  READY
  INVOICED
  FOLLOW_UP_SCHEDULED
  PAID
}
